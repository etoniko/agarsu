<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="agar.su - захватывающая онлайн-игра, где вам предстоит выживать, поглощая других игроков и избегая опасных врагов. Боритесь за лидерство и испытайте свои навыки!">
    <meta name="keywords" content="игры, game, браузерная игра, агарио, agario, онлайн игра, клетка, выживание, agar.io">
    <meta name="author" content="Agar.su Team">
    <meta name="robots" content="index">

    <!-- Open Graph для социальных сетей -->
    <meta property="og:title" content="Agar.su - Завоевание начинается!">
    <meta property="og:description" content="Играйте в agar.su — мир клеток, где нужно выживать, поглощая других игроков и избегая опасностей.">
    <meta property="og:image" content="assets/photo/ogimage.jpeg">
    <meta property="og:url" content="https://agar.su">
    <meta property="og:type" content="website">

    <title>Agar.su</title>

    <!-- Favicon и иконки для Apple устройств -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/etoniko/agarsu/icon.svg/icon.svg">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/etoniko/agarsu/icon.svg" type="image/svg+xml">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://agar.su">

    <!-- Шрифты и стили -->
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=new_releases" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="/style.css?v=4.0.4" rel="stylesheet">

    <!-- Скрипты -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/log.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/vector.js"></script>
    <script src="/main_out.js?v=4.3.3"></script>
</head>
<body>
    <div id="overlays" class="overlays">
        <div class="social">
            <a href="https://t.me/agarsu" target="_blank" class="tg"><i style="background: radial-gradient(white 9px, #1e90ff00 50%);border-radius: 50%;" class="fab fa-telegram"></i></a>
            <a href="#" class="soc"><i style="cursor: not-allowed;" class="fab fa-vk"></i></a>
            <a href="#" class="soc"><i style="cursor: not-allowed;" class="fab fa-discord"></i></a>
        </div>
        <div class="center">
            <div class="sidebar">
                <div class="menu-item" onclick="showContent('shop')"><i class="fas fa-shop"></i><span class="label">Магазин</span></div>
                <div class="menu-item" onclick="showContent('skinslist')"><i class="fas fa-image"></i><span class="label">Скины</span></div>
                <div class="menu-item active" onclick="showContent('home')"><i class="fas fa-home"></i><span class="label">Главная</span></div>
                <div class="menu-item" onclick="showContent('rating')"><i class="fas fa-star"></i><span class="label">Рейтинг</span></div>
                <div class="menu-item" onclick="showContent('store')"><i class="fas fa-user"></i><span class="label">Войти</span></div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
<div id="shop" class="content">
  <div class="top-info">
    <div class="stages">
      <div class="stage active" data-step="1"><span>1</span><div class="label">Выбор</div></div>
      <div class="stage" data-step="2"><span>2</span><div class="label">Данные</div></div>
      <div class="stage" data-step="3"><span>3</span><div class="label">Оплата</div></div>
    </div>
  </div>

  <div id="step-content">
    <!-- Шаг 1 -->
    <div class="step active" data-step="1">
      <h3>Выберите услугу</h3>
      <div style="margin-bottom:10px;">
        <label><input type="radio" name="serviceType" value="self" checked> Для себя</label>
        <label><input type="radio" name="serviceType" value="clan"> Для клана</label>
      </div>

      <div class="skins-grid" id="skinsGrid">
        <div class="skin-card" data-type="image" data-base="100" data-src-self="https://agar.su/skins/3.png" data-src-clan="https://agar.su/skins/skinclan.png">
          <img style="border: solid;border-radius: 100%;margin-bottom: 10px;" src="https://agar.su/skins/3.png" alt="png">
          <h4>Скин PNG/JPEG</h4>
          <p class="price-label" data-base="100">Цена: 100</p>
          <button class="btnn">Выбрать</button>
        </div>

        <div class="skin-card" data-type="pass" data-base="200" data-src-self="https://agar.su/assets/photo/shopnick.png" data-src-clan="https://agar.su/assets/photo/shopclan.png">
          <img style="margin-bottom: 10px;" src="https://agar.su/assets/photo/shopnick.png" alt="pass">
          <h4>Пароль на ник</h4>
          <p class="price-label" data-base="200">Цена: 200</p>
          <button class="btnn">Выбрать</button>
        </div>

        <div class="skin-card" data-type="gif" data-base="3000" data-src-self="https://agar.su/assets/photo/console.gif" data-src-clan="https://agar.su/assets/photo/gifclan.gif">
          <img style="border: solid;border-radius: 100%;margin-bottom: 10px;" src="https://agar.su/assets/photo/console.gif" alt="gif">
          <h4>Мульти Скин Gif</h4>
          <p class="price-label" data-base="3000">Цена: 3000</p>
          <button class="btnn">Выбрать</button>
        </div>
      </div>
    </div>

    <!-- Шаг 2 -->
    <div class="step" data-step="2">
      <h3 id="chosenTitle">Данные для товара</h3>
      <form id="dataForm">
        <label>
          <input id="nickname" maxlength="16" class="shopnp" type="text" placeholder="ник" title="Введите ник" autocomplete="off">
        </label>

        <label id="passLabel" style="display:none;">
          <input id="password" maxlength="6" class="shopnp" type="text" placeholder="пароль" title="Введите пароль" autocomplete="off">
        </label>

        <div id="uploadCircle">
          <input id="imageFile" type="file" accept="image/*" style="display:none;">
          <span>Загрузите изображение</span>
        </div>

        <div style="margin-top:12px;">
          <button type="button" id="backToChoose" class="btnn ghost">Назад</button>
          <button type="submit" class="btnn">Перейти к оплате</button>
        </div>
      </form>
    </div>

    <!-- Шаг 3 -->
    <div class="step" data-step="3">
      <h3 id="finalTitle">Оплата</h3>
      <p>Переведите точную сумму в течение 10 минут</p>
      <div class="price" id="price">100.00₽</div>
      <div class="timer">Осталось: <span id="countdown">10:00</span></div>
      <div class="reqs">
        <div class="sbp">СБП: +79969712765 (Сбербанк)</div>
        <div class="mir">Карта МИР: 2202 2081 8483 3425</div>
      </div>
      <div>
        <button class="btnn ghost" id="backToData">Назад</button>
        <button class="btnn" id="paidBtn">Я оплатил</button>
      </div>
      <div style="font-size: 11px;color: #7e7e7e;margin-top: 10px;display: flex;flex-direction: column;">
        ИП: Дараселиа Николоз Ираклиевич ИНН: 503830093674 ООО «АгарСу»
      </div>
      <div id="expiredBox" class="hiddenn" style="margin-top:12px; color:#f55; font-weight:700;">
        ⛔ Время истекло — начните заново
        <div style="margin-top:8px;">
          <button class="btnn" id="restartBtn">Начать заново</button>
        </div>
      </div>
    </div>
  </div>

  <div id="shopToastContainer" aria-live="polite" aria-atomic="true"></div>
</div>

<script>
(function(){
  let currentStep = 1;
  let chosenSkin = null, chosenType = null, chosenPrice = 0, processedImageUrl = null;
  let serviceType = 'self';
  let timer = 10*60, timerInterval = null;

  const stages = document.querySelectorAll('#shop .stage');
  const stepContents = document.querySelectorAll('#shop #step-content > div.step');
  const chosenTitleEl = document.getElementById('chosenTitle');
  const finalTitleEl = document.getElementById('finalTitle');
  const priceEl = document.getElementById('price');
  const countdownEl = document.getElementById('countdown');
  const passLabel = document.getElementById('passLabel');
  const nicknameInput = document.getElementById('nickname');
  const passwordInput = document.getElementById('password');
  const uploadCircle = document.getElementById('uploadCircle');
  const imageInput = document.getElementById('imageFile');
  const expiredBox = document.getElementById('expiredBox');
  const paidBtn = document.getElementById('paidBtn');
  const skinsGrid = document.getElementById('skinsGrid');
  const serviceRadios = document.querySelectorAll('input[name="serviceType"]');

  // --- уведомления ---
  const notificationEl=document.createElement('div');
  notificationEl.id='shopNotification';
  notificationEl.style.cssText="position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#1b263b;color:#fff;padding:12px 20px;border-radius:12px;font-weight:700;z-index:9999;opacity:0;transition:opacity 0.3s,transform 0.3s;";
  document.body.appendChild(notificationEl);
  function notify(msg,duration=3000){
    notificationEl.textContent=msg;
    notificationEl.style.opacity='1';
    notificationEl.style.transform='translateX(-50%) translateY(0)';
    setTimeout(()=>{
      notificationEl.style.opacity='0';
      notificationEl.style.transform='translateX(-50%) translateY(-20px)';
    },duration);
  }

  // --- переключение для себя / клана ---
  serviceRadios.forEach(r=>{
    r.addEventListener('change',()=>{
      serviceType=r.value;
      nicknameInput.placeholder=serviceType==='clan'?'клан':'ник';
      nicknameInput.title=serviceType==='clan'?'Введите название клана':'Введите ник';

      document.querySelectorAll('#skinsGrid .skin-card').forEach(card=>{
        const base=Number(card.dataset.base);
        const price=serviceType==='clan'?base*2:base;
        card.querySelector('.price-label').textContent=`Цена: ${price}`;
        card.querySelector('img').src=serviceType==='clan'?card.dataset.srcClan:card.dataset.srcSelf;

        // если карточка пароля — меняем заголовок
        if(card.dataset.type==='pass'){
          card.querySelector('h4').textContent = serviceType==='clan' ? 'Пароль на клан' : 'Пароль на ник';
        }
      });
    });
  });

  // --- выбор товара ---
  skinsGrid.addEventListener('click', e => {
    if(e.target.tagName==='BUTTON'){
      const card = e.target.closest('.skin-card');
      chosenSkin = card.querySelector('h4').textContent;
      chosenType = card.dataset.type;

      const base = Number(card.dataset.base);
      const rand = Math.floor(Math.random()*10);
      chosenPrice = (serviceType==='clan'?base*2:base)+rand;

      passLabel.style.display = chosenType==='pass' ? 'block' : 'none';
      uploadCircle.style.display = chosenType==='pass' ? 'none' : 'flex';

      chosenTitleEl.textContent = `Вы выбрали: ${chosenSkin}`;
      priceEl.textContent = `${chosenPrice}₽`;
      setActiveStep(2);
    }
  });

  // --- загрузка файла с проверкой размера ---
  uploadCircle.addEventListener('click',()=>imageInput.click());
  imageInput.addEventListener('change',()=>{
    const file=imageInput.files[0]; 
    if(!file) return;

    if(file.size > 10*1024*1024){
      notify('❌ Файл больше 10MB');
      imageInput.value='';
      return;
    }

    const name=file.name.toLowerCase();
    if(chosenType==='gif'&&!name.endsWith('.gif')){
      notify('❌ Только GIF!');
      imageInput.value='';
      return;
    }
    if(chosenType==='image'&&!(/\.(png|jpg|jpeg)$/i.test(name))){
      notify('❌ Разрешены PNG/JPG!');
      imageInput.value='';
      return;
    }

    const reader=new FileReader();
    reader.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        uploadCircle.innerHTML='';
        uploadCircle.appendChild(img);
      };
      img.src=e.target.result;
      processedImageUrl=e.target.result;
    };
    reader.readAsDataURL(file);
  });

  // --- просто ограничение ввода ника ---
  nicknameInput.addEventListener('blur', ()=>{
    let nick = nicknameInput.value.trim();
    nicknameInput.value = nick.replace(/['`";:]/g,'').slice(0,20);

    if(serviceType==='clan'){
      const clanPattern = /^(\[.*\]|\|.*\||\{.*\}|\(.*\))$/;
      if(!clanPattern.test(nick)){
        notify('❌ У клана должны быть скобки [ ] || { } ( )');
        return;
      }
    }
  });

  // --- переход к оплате ---
  document.getElementById('dataForm').addEventListener('submit', e=>{
    e.preventDefault();
    const nick = nicknameInput.value.trim();
    const pass = passwordInput.value.trim();

    if(!nick){notify(serviceType==='clan'?'Введите название клана':'Введите ник');return;}
    if(serviceType==='clan'){
      const clanPattern = /^(\[.*\]|\|.*\||\{.*\}|\(.*\))$/;
      if(!clanPattern.test(nick)){notify('❌ У клана должны быть скобки [ ] || { } ( )');return;}
    }
    if(chosenType==='pass'){
      if(!pass){notify('❌ Введите пароль');return;}
      if(pass.length>5){notify('❌ Пароль ≤5 символов');return;}
    }
    if(chosenType!=='pass'&&!processedImageUrl){notify('❌ Загрузите изображение');return;}

    finalTitleEl.textContent=`Оплата — ${chosenSkin}`;
    priceEl.textContent=`${chosenPrice}₽`;
    paidBtn.disabled=false;
    expiredBox.classList.add('hiddenn');
    startTimer();
    setActiveStep(3);
  });

  // --- таймер ---
  function startTimer(){
    clearInterval(timerInterval);
    timer=10*60;
    updateTimer();
    timerInterval=setInterval(()=>{
      if(timer>0){
        timer--;
        updateTimer();
      }else{
        clearInterval(timerInterval);
        onExpired();
      }
    },1000);
  }
  function updateTimer(){
    const m=Math.floor(timer/60),s=timer%60;
    countdownEl.textContent=`${m}:${s.toString().padStart(2,'0')}`;
  }
  function onExpired(){
    countdownEl.textContent='00:00';
    expiredBox.classList.remove('hiddenn');
    paidBtn.disabled=true;
  }

  // --- кнопки назад ---
  document.getElementById('backToChoose').addEventListener('click',()=>setActiveStep(1));
  document.getElementById('backToData').addEventListener('click',()=>setActiveStep(2));

  // --- отправка ---
  paidBtn.addEventListener('click',async ()=>{
    const nick = nicknameInput.value.trim();
    const pass = passwordInput.value.trim();
    const formData = new FormData();
    formData.append('nickname',nick);
    formData.append('price',chosenPrice);
    formData.append('serviceType',serviceType);
    let endpoint='';
    if(chosenType==='pass'){
      formData.append('password',pass);
      endpoint='https://pmori.ru:6005/submit-pass';
    } else {
      if(!imageInput.files[0]){notify('❌ Файл не выбран');return;}
      formData.append('file',imageInput.files[0]);
      formData.append('type',chosenType);
      endpoint='https://pmori.ru:6005/submit-skin';
    }
    try{
      const res = await fetch(endpoint,{method:'POST',body:formData});
      const data = await res.json();
      if(data.success){
        notify('✅ Идет модерация 10-30 минут.');
        resetShop();
      } else {
        notify('❌ Ошибка: '+data.error);
      }
    }catch(err){
      notify('⚠ Ошибка сети: '+err.message);
    }
  });

  // --- начать заново ---
  document.getElementById('restartBtn').addEventListener('click',resetShop);
  function resetShop(){
    clearInterval(timerInterval);
    setActiveStep(1);
    imageInput.value='';
    uploadCircle.innerHTML='<span>Загрузите изображение</span>';
    nicknameInput.value='';
    passwordInput.value='';
    processedImageUrl=null;
    expiredBox.classList.add('hiddenn');
    paidBtn.disabled=false;
    finalTitleEl.textContent='Оплата';
    priceEl.textContent='100.00₽';
    chosenSkin=null;
    chosenType=null;
    chosenPrice=0;
  }

  function setActiveStep(step){
    currentStep=step;
    stages.forEach(s=>s.classList.toggle('active',Number(s.dataset.step)===step));
    stepContents.forEach(c=>c.classList.toggle('active',Number(c.dataset.step)===step));
  }

  setActiveStep(1);
})();
</script>













                  <div id="settings" class="content">
                    <div class="top-info">
                        <div><span>Настройки</span></div>
                    </div>
                    <div class="checkbox-container">
                        <label><input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));">Оключить Имена</label>
                        <label><input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));">Без Цветов</label>
                        <label><input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));" checked>Показать Массу</label>
                        <label><input type="checkbox" class="save" data-box-id="6" onchange="setSmooth($(this).is(':checked'));">Простой Рендер</label>
                        <label><input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));">Отключить Чат</label>
                        <label><div id="theme-selector"><label>Выберите тему:</label><select id="theme-select"><option value="gradient">Градиент</option><option value="white">Белая</option><option value="black">Черная</option></select></div></label>
                    </div>
                </div>
                <div id="skinslist" class="content">
                    <div style="display: flex;flex-direction: column;justify-content: space-around;" class="top-info">
                        <div class="gall"><span>Скины</span></div>
                        <ul class="gallery">
  <li style="background-image: url('https://i.imgur.com/tq33YWv.png');" onclick="selectSkin('Муха');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/dzQIxk0.png');" onclick="selectSkin('Паук');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/fpDpEl9.png');" onclick="selectSkin('Кактус');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/69ChrNV.png');" onclick="selectSkin('Зая');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/qRq5CIg.png');" onclick="selectSkin('Оса');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/TPgKn6V.png');" onclick="selectSkin('Ящерица');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/QPCVdvQ.png');" onclick="selectSkin('Лиса');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/YbmC0tv.png');" onclick="selectSkin('Волк');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/hmVJPmb.png');" onclick="selectSkin('Мамонт');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/RKtDpin.png');" onclick="selectSkin('Динозавр');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/3hxdGAq.png');" onclick="selectSkin('Мороженое');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/zdcHEFS.png');" onclick="selectSkin('Ракета');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/roUvNMV.png');" onclick="selectSkin('Могучая');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/57BzylL.png');" onclick="selectSkin('Фаун');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/rPlbHK7.png');" onclick="selectSkin('Бабушка');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/ruAUEpb.png');" onclick="selectSkin('Гора');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/ipqCMMf.png');" onclick="selectSkin('Космонавт');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/wRiL4Jx.png');" onclick="selectSkin('Первобытный');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/GTxoIhj.png');" onclick="selectSkin('Влюблённый');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/EcW6zbE.png');" onclick="selectSkin('Влюблённая');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/UINxrlJ.png');" onclick="selectSkin('Самба');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/lxAXnAi.png');" onclick="selectSkin('Снеговик');showContent('home')"></li>
  <li style="background-image: url('https://i.imgur.com/7GWqCnY.png');" onclick="selectSkin('Панда');showContent('home')"></li>
  <li><a href="https://t.me/agarskins_bot" style="display: block;width: 100%;height: 100%;background-image: url('assets/photo/skinstg.png');background-size: cover;"></a></li>
                        </ul>
                    </div>
                </div>
                <!-- Home Content -->
                <div id="home" class="content active">
<div class="top-info"><div><span>agar.su</span><div onclick="showContent('settings')" style="position: absolute;margin-left: 140px;background-color: #1b263b;padding: 10px;border-radius: 100%;" class="menu-item"><i class="fas fa-gear"></i></div></div></div>
<div><div class="line"></div><span id="process">Онлайн☹️: 0</span></div>
<div class="progress-container"><div class="progress-bar"><div class="level-circle" id="levelCircle">0</div><div class="progress-fill"></div><div class="progress-text" id="progressText">0% (0/0)</div></div></div>
                    <span id="accountID">ID: 0000</span>

                    <script>
                        async function updateOnlineCount() {
                            try {
                                const response = await fetch('https://pmori.ru:6001/process'); // Запрос к серверу по /process
                                if (response.ok) {
                                    const data = await response.json(); // Преобразуем ответ в JSON
                                    document.getElementById('process').textContent = `Онлайн: ${data.online}`; // Обновляем текст в div
                                } else {
                                    console.error('Ошибка при получении данных:', response.status);
                                }
                            } catch (error) {
                                console.error('Произошла ошибка:', error);
                            }
                        }

                        updateOnlineCount();
                    </script>
                    <div class="avatar-containers">
                        <div class="avatar-container">
                            <div class="previous-skin" id="prevSkin" onclick="showPrevious()"></div>
                            <div class="arrow" id="previous" onclick="showPrevious()">&#10094;</div>
                            <div onclick="showContent('skinslist')" id="skinss" class="main-skin"></div>
                            <div class="arrow" id="next" onclick="showNext()">&#10095;</div>
                            <div class="next-skin" id="nextSkin" onclick="showNext()"></div>
                        </div>
                        <!-- Новый элемент сервера -->
                        <div id="server" class="server-containers" style="display: none;">
                            <div class="sgm">Выбери себе режим!</div>
                            <div class="gamemode">
                                <div class="thumbnail ffa actives" onclick="setserver('pmori.ru:6001');toggleServer();">ФФА</div>
                                <div class="thumbnail crazy" onclick="setserver('pmori.ru:6002');toggleServer();">КРЕЗИ</div>
                                <div style="cursor: not-allowed;opacity: 0.6;" class="thumbnails teams">ТИМА</div>
                                <div class="thumbnail exp" onclick="setserver('pmori.ru:6004');toggleServer();">ЕКСП</div>
                                <script>
                                    function updateActiveThumbnail() {
                                        const hash = window.location.hash.substring(1);
                                        const thumbnails = document.querySelectorAll('.thumbnail');

                                        // Remove active from all
                                        thumbnails.forEach(el => el.classList.remove('actives'));

                                        // Add active based on hash, fallback to FFA
                                        const activeThumbnail = Array.from(thumbnails).find(el => el.classList.contains(hash)) || document.querySelector('.ffa');
                                        activeThumbnail.classList.add('actives');
                                    }

                                    // Initial check on page load
                                    updateActiveThumbnail();

                                    // Add event listener for hash changes
                                    window.addEventListener('hashchange', updateActiveThumbnail);


                                    // Add event listeners to thumbnails
                                    document.querySelectorAll('.thumbnail').forEach(item => {
                                        item.addEventListener('click', () => {
                                            //Remove active from all
                                            document.querySelectorAll('.thumbnail').forEach(el => el.classList.remove('actives'));

                                            //Add active to clicked
                                            item.classList.add('actives');

                                            //Update the URL hash
                                            window.location.hash = item.classList[1];
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="input-container">
                            <form>
                                <input type="text" placeholder="Ник" name="name" maxlength="16" class="noPress" id="nick" required
                                       autocomplete="username" />
                                <input type="password" placeholder="Пасс" name="pass" maxlength="6" class="noPress" id="pass" required
                                       autocomplete="current-password" />
                            </form>
                        </div>
                        <script>
                           document.addEventListener('DOMContentLoaded', () => {
    const nickInput = document.getElementById('nick');
    const passInput = document.getElementById('pass');
    let allowedNicks = [];

    // --- Универсальная функция нормализации ника ---
function normalizeNick(nick) {
    if (!nick) return '';

    let n = nick.trim();

    const brackets = { '[': ']', '{': '}', '(': ')', '|': '|' };
    const firstChar = n.charAt(0);
    const lastChar = n.charAt(n.length - 1);

    if (brackets[firstChar]) {
        const closeChar = brackets[firstChar];
        const endIndex = n.indexOf(closeChar, 1);

        // Проверяем, что закрывающая скобка есть и ник внутри не пустой
        if (endIndex === -1) return ''; 

        const innerNick = n.substring(1, endIndex);
        if (!innerNick || innerNick.trim() !== innerNick) return ''; // нет пробелов в начале/конце

        n = innerNick; 
    } else {
        // Ник без скобок: нельзя содержать пробелы в начале/конце
        if (!n || n.trim() !== n) return '';
    }

    return n.toLowerCase();
}

    // --- Работа с cookie ---
    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + encodeURIComponent(value || "") + expires + "; path=/";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length));
        }
        return null;
    }

    // --- Загрузка списка ников ---
    fetch('pass.txt?v=0.0.1')
        .then(response => {
            if (!response.ok) throw new Error('Не удалось загрузить pass.txt');
            return response.text();
        })
        .then(data => {
            allowedNicks = data.split('\n')
                               .map(n => normalizeNick(n))
                               .filter(n => n !== '');

            const savedNick = getCookie('userNick');
            const savedPass = getCookie('userPass');

            if (savedNick) {
                nickInput.value = savedNick;
                checkNickStatus(savedNick);
            }

            if (savedPass) {
                passInput.value = savedPass;
            }
        })
        .catch(error => {
            console.error('Ошибка при загрузке pass.txt:', error);
        });

    function checkNickStatus(nick) {
        const normalized = normalizeNick(nick);
        if (allowedNicks.includes(normalized)) {
            passInput.style.display = 'block';
        } else {
            passInput.style.display = 'none';
        }
    }

    // --- Сохраняем изменения в полях ---
    nickInput.addEventListener('input', () => {
        const currentNick = nickInput.value.trim();
        if (currentNick) {
            setCookie('userNick', currentNick, 7);
        } else {
            setCookie('userNick', '', -1); // Удалить cookie
            passInput.style.display = 'none';
        }
        checkNickStatus(currentNick);
    });

    passInput.addEventListener('input', () => {
        const currentPass = passInput.value.trim();
        if (currentPass) {
            setCookie('userPass', currentPass, 7);
        } else {
            setCookie('userPass', '', -1); // Удалить cookie
        }
    });
});
                        </script>
                    </div>

                    <script>
// Переменные для отслеживания действий
let lastActionTime = 0; // Время последнего действия
const actionInterval = 500; // Интервал между действиями (в мс)
let actionTimeout; // Таймер для обработки ввода
let currentIndex = 0; // Индекс текущего игрока

// Функция загрузки списка скинов
async function loadSkinsList() {
    const response = await fetch('skinlist.txt?0.0.3');
    const data = await response.text();
    const skinsMap = new Map();

    data.split('\n').forEach(line => {
        const [nick, id] = line.split(':');
        if (nick && id) skinsMap.set(normalizeNick(nick), id.trim());
    });
    return skinsMap;
}

// Функция нормализации ника для поиска
function normalizeNick(nick) {
    if (!nick) return '';

    let n = nick.trim();

    const brackets = { '[': ']', '{': '}', '(': ')', '|': '|' };
    const firstChar = n.charAt(0);
    const lastChar = n.charAt(n.length - 1);

    if (brackets[firstChar]) {
        const closeChar = brackets[firstChar];
        const endIndex = n.indexOf(closeChar, 1);

        // Проверяем, что закрывающая скобка есть и ник внутри не пустой
        if (endIndex === -1) return ''; 

        const innerNick = n.substring(1, endIndex);
        if (!innerNick || innerNick.trim() !== innerNick) return ''; // нет пробелов в начале/конце

        n = innerNick; 
    } else {
        // Ник без скобок: нельзя содержать пробелы в начале/конце
        if (!n || n.trim() !== n) return '';
    }

    return n.toLowerCase();
}


                        // Функция выбора скина и сохранения данных игрока в localStorage
                        async function selectSkin(nick) {
                            const skinsMap = await loadSkinsList();
                            const normalizedNick = normalizeNick(nick);

                            // Проверка, если скин найден
                            if (skinsMap.has(normalizedNick)) {
                                const id = skinsMap.get(normalizedNick);

                                // Сохранение данных игрока в localStorage
                                savePlayerData(nick, id);
                                currentIndex = getCurrentPlayerIndex(nick); // Обновление индекса
                                updateAvatarDisplay(); // Обновление аватара
                            } else {
                                document.querySelector("#skinss").style.backgroundImage = ""; // Очистка фона
                            }
                        }

                        // Функция получения текущего индекса игрока из localStorage
                        function getCurrentPlayerIndex(nick) {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            return players.findIndex(player => normalizeNick(player.nick) === normalizeNick(nick));
                        }

                        // Функция сохранения данных игрока в localStorage
                        function savePlayerData(nick, id) {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            const playerData = { nick, id }; // Сохраняем ник и скин

                            // Удаление дубликатов
                            const index = players.findIndex(player => normalizeNick(player.nick) === normalizeNick(nick));
                            if (index !== -1) players.splice(index, 1);

                            // Добавление нового игрока в начало
                            players.unshift(playerData);

                            // Ограничение хранения последних 3 игроков
                            if (players.length > 3) players.pop();

                            localStorage.setItem('players', JSON.stringify(players)); // Сохранение в localStorage
                        }

                        // Функция обновления отображения аватаров
                        function updateAvatarDisplay() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            const mainSkin = document.querySelector("#skinss");
                            const previousSkin = document.querySelector("#prevSkin");
                            const nextSkin = document.querySelector("#nextSkin");

                            // Очистка фонов
                            mainSkin.style.backgroundImage = "";
                            previousSkin.style.backgroundImage = "";
                            nextSkin.style.backgroundImage = "";

                            if (players.length > 0) {
                                const currentPlayer = players[currentIndex];
                                mainSkin.style.backgroundImage = `url(skins/${currentPlayer.id}.png)`; // Выставляем скин
                                document.getElementById("nick").value = currentPlayer.nick;

                                // Установка предыдущего скина
                                const prevIndex = (currentIndex - 1 + players.length) % players.length;
                                if (players[prevIndex]) {
                                    previousSkin.style.backgroundImage = `url(skins/${players[prevIndex].id}.png)`;
                                }

                                // Установка следующего скина
                                const nextIndex = (currentIndex + 1) % players.length;
                                if (players[nextIndex]) {
                                    nextSkin.style.backgroundImage = `url(skins/${players[nextIndex].id}.png)`;
                                }
                            }
                        }

                        // Показ следующего игрока
                        function showNext() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            if (players.length > 0) {
                                currentIndex = (currentIndex + 1) % players.length;
                                changeSkin();
                            }
                        }

                        // Показ предыдущего игрока
                        function showPrevious() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            if (players.length > 0) {
                                currentIndex = (currentIndex - 1 + players.length) % players.length;
                                changeSkin();
                            }
                        }

                        // Анимация смены скина
                        function changeSkin() {
                            const mainSkin = document.querySelector("#skinss");
                            mainSkin.classList.add("scale-down");
                            setTimeout(() => {
                                updateAvatarDisplay();
                                mainSkin.classList.remove("scale-down");
                            }, 50);
                        }

                        // Обработчик ввода ника
                        document.getElementById('nick').addEventListener('input', function () {
                            const nickname = this.value;
                            clearTimeout(actionTimeout);
                            actionTimeout = setTimeout(async () => {
                                await selectSkin(nickname);
                            }, actionInterval);
                        });

                        // Загрузка сохранённых данных при загрузке страницы
                        window.addEventListener("load", function () {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');

                            if (players.length > 0) {
                                currentIndex = 0;
                                updateAvatarDisplay();
                            }
                        });

                    </script>

                    <div class="nav-buttons">
                        <!--<span style="position: absolute;margin-right: 20px;color: #ffec0c;border-radius: 100%;background-image: linear-gradient(red, red);background-repeat:no-repeat;background-size: 14px 15px;background-position: center;" class="material-symbols-outlined">new_releases</span>-->
                        <div onclick="toggleServer();" class="nav-button serv-button">
                            <i class="fas fa-server"></i>
                            СЕРВЕРА
                        </div>
                        <!-- change div -> button | Disabled button xxxevexxx -->
                        <button id="button-text" onclick="startGame();return false;" class="nav-button play-button">
                            <i class="fas fa-play"></i> ИГРАТЬ
                        </button>
                        <script>
function startGame() {
    setNick(document.getElementById('nick').value + "#" + document.getElementById('pass').value);
setTimeout(function() {
setNick(document.getElementById('nick').value + "#" + document.getElementById('pass').value);
}, 1000);
}
                        </script>
                        <!-- change div -> button | Disabled button xxxevexxx -->
                        <button id="button-spec" class="spec" onclick="spectate();">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <script>
                        let isServerOpen = false; // Переменная для отслеживания состояния сервера

                        function toggleServer() {
                            if (isServerOpen) {
                                closeServer();
                            } else {
                                openServer();
                            }
                        }

                        function openServer() {
                            const server = document.getElementById('server');
                            const avatarContainer = document.querySelector('.avatar-container');
                            const inputContainer = document.querySelector('.input-container');
                            const sgm = document.querySelector('.sgm');
                            const photoGallery = document.querySelector('.gamemode');

                            server.style.display = 'flex'; // Показать элемент сервера
                            requestAnimationFrame(() => {
                                server.classList.add('visible'); // Анимация появления сервера
                                sgm.classList.add('visible'); // Анимация появления sgm
                                photoGallery.classList.add('visible'); // Анимация появления photo-gallery
                            });

                            // Скрываем аватар и input-container
                            avatarContainer.classList.add('hidden');
                            inputContainer.classList.add('hidden');

                            isServerOpen = true; // Устанавливаем состояние сервера в открытое
                        }

                        function closeServer() {
                            const server = document.getElementById('server');
                            const avatarContainer = document.querySelector('.avatar-container');
                            const inputContainer = document.querySelector('.input-container');
                            const sgm = document.querySelector('.sgm');
                            const photoGallery = document.querySelector('.gamemode');

                            server.classList.remove('visible'); // Анимация исчезновения сервера
                            sgm.classList.remove('visible'); // Анимация исчезновения sgm
                            photoGallery.classList.remove('visible'); // Анимация исчезновения photo-gallery

                            server.addEventListener('transitionend', () => {
                                server.style.display = 'none'; // Скрыть сервер после завершения анимации
                            }, { once: true });

                            // Показываем аватар и input-container
                            avatarContainer.classList.remove('hidden');
                            inputContainer.classList.remove('hidden');

                            isServerOpen = false; // Устанавливаем состояние сервера в закрытое
                        }

                    </script>
                </div>
<div id="rating" class="content">
    <div class="top-info">
        <div><span>Лучшие Игроки</span></div>
    </div>
    <div class="header-row">
        <div class="cell">Позиция</div>
        <div class="cell">ID</div>
        <div class="cell">Ник</div>
        <div class="cell">Уровень</div>
        <div class="cell">Аватар</div>
    </div>
    <div id="table-container"></div>

    <script>
        // Функция вычисления уровня из XP
        const getLevel = xp => ~~((xp / 100 * 2) ** 0.5);

        // Отображение топ-100
        function xpStats(xstats) {
            const container = document.getElementById('table-container');
            container.innerHTML = '';

            xstats.forEach(player => {
                const level = getLevel(player.xp);

                const playerDiv = document.createElement('div');
                playerDiv.classList.add('top-player');
                playerDiv.innerHTML = `
<div class="time">${player.position}</div> 
<div class="rank">${player.uid}</div> 
<div class="nick">${player.account_name}</div> 
<div class="score">${level}</div> 
<div class="skkinn" style="background-image: url('${player.account_avatar}');"></div>
                `;
                container.appendChild(playerDiv);
            });
        }

        // Получение данных с сервера
        async function fetchTop100() {
            try {
                const res = await fetch('https://pmori.ru:6003/api/top100');
                const data = await res.json();

                xpStats(data);
            } catch (err) {
                console.error('Error fetching top 100:', err);
            }
        }

        fetchTop100();
    </script>
</div>


                <div id="store" class="content">
                    <div class="top-info">
                        <div><span>Кабинет</span></div>
                    </div>
<div class="header-row">


<button style="display:none" id="logoutButton" onclick="logoutAccount()">Выход</button>

<div id="authlog">
  <div id="g_id_onload" data-client_id="157257230972-jhlcisbgal67sn75gib37fb1m1de5jiu.apps.googleusercontent.com" data-auto_prompt="false" data-callback="onGoogleAuth">
  </div>
<div class="g_id_signin"></div>

  <!-- Telegram Authorization -->
  <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="agarsu_auth_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
</div>


</div>

</div>

                </div>
            </div>

            <script>
                function showContent(id) {
                    document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
                    document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));

                    document.querySelector(`.menu-item[onclick="showContent('${id}')"]`).classList.add('active');
                    document.getElementById(id).classList.add('active');
                }
            </script>
        </div>
    </div>

 <canvas id="canvas"></canvas>
<div id="recContainer">
    <button id="recToggle" class="material-icons">videocam</button>
    <div id="recInfo" style="display: none;">
        <span id="recText"></span>
        <span id="recTimer">00:00</span>
    </div>
</div>

<style>
@import url('https://fonts.googleapis.com/icon?family=Material+Icons');
/* Скрываем на мобильных */
@media (max-width: 599px) {
    #recContainer {
        display: none !important;
    }
#statics > div:nth-child(1),
#statics > div:nth-child(3) {
  display: none;
}
}
#recContainer {
    position: absolute;
    top: 40%;
    right: 10px;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column; 
    align-items: center;
    gap: 10px;
    font-family: Arial, sans-serif;
}

#recToggle {
    border: solid #ffffff26 1px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    height: 40px;
    width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    font-size: 20px;
    position: relative;
    transition: all 0.2s ease;
}

#recDot {
    position: absolute;
    top: 8px;
    left: 8px;
    width: 12px;
    height: 12px;
    background: red;
    border-radius: 50%;
    box-shadow: 0 0 8px red;
    animation: blink 1s infinite;
    display: none;
}

@keyframes blink {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
}

#recInfo {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    text-shadow: 0 0 5px black;
    font-size: 14px;
}

#recTimer {
    font-weight: bold;
    font-size: 16px;
}
#authlog{
    width: 100%;
    display: flex;
    align-items: center;
    flex-direction: column;
    height: 300px;
    justify-content: center;
    gap: 10px;
}


</style>

<script>
const canvas = document.getElementById('canvas');
var overlays = document.getElementById('overlays');
const recToggle = document.getElementById('recToggle');
const recInfo = document.getElementById('recInfo');
const recText = document.getElementById('recText');
const recTimer = document.getElementById('recTimer');

// Красная мигающая точка
const recDot = document.createElement('div');
recDot.id = 'recDot';
recToggle.appendChild(recDot);

// Поток для записи
const stream = canvas.captureStream(60);

// Проверка поддержки VP9, fallback на VP8
let mimeType = 'video/webm; codecs=vp9';
if (!MediaRecorder.isTypeSupported(mimeType)) {
    mimeType = 'video/webm; codecs=vp8';
}

const recorder = new MediaRecorder(stream, { 
    mimeType: mimeType,
    videoBitsPerSecond: 5_000_000 
});

let chunks = [];
recorder.ondataavailable = e => chunks.push(e.data);
recorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'video/webm' });
    chunks = [];
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'game_record.webm';
    a.click();
    URL.revokeObjectURL(url);
};

// Таймер
let recording = false;
let startTime;
let timerInterval;

function updateTimer() {
    let elapsed = Math.floor((Date.now() - startTime)/1000);
    let minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
    let seconds = String(elapsed % 60).padStart(2, '0');
    recTimer.textContent = `${minutes}:${seconds}`;
}

// START / STOP запись
recToggle.onclick = () => {
    if (!recording) {
        // Старт записи
        recorder.start();
        recording = true;
        recDot.style.display = 'block';
        recInfo.style.display = 'flex';
        recText.textContent = 'Идёт запись';
        startTime = Date.now();
        timerInterval = setInterval(updateTimer, 1000);
        recToggle.innerText = "videocam_off"; // меняем иконку
    } else {
        // Стоп записи
        recorder.stop();
        recording = false;
        recDot.style.display = 'none';
        recInfo.style.display = 'none';
        clearInterval(timerInterval);
        recTimer.textContent = '00:00';
        recText.textContent = '';
        recToggle.innerText = "videocam"; // сброс иконки
    }
};

        // Добавляем слушатель события мыши на div-элемент overlays
        overlays.addEventListener('mousemove', function (event) {
            // Получаем позицию курсора относительно overlays
            var x = event.clientX - overlays.offsetLeft;
            var y = event.clientY - overlays.offsetTop;

            // Создаем событие мыши для канваса
            var canvasEvent = new MouseEvent('mousemove', {
                bubbles: true,
                cancelable: true,
                clientX: x,
                clientY: y
            });

            // Передаем событие канвасу
            canvas.dispatchEvent(canvasEvent);
        });
</script>


<style>
.chatX_window {width: 310px;background: rgba(0, 0, 0, .3);border-radius: 25px;padding: 10px 5px 12px;position: absolute;left: 10px;bottom: 10px;display: flex;flex-direction: column;overflow: hidden;min-height: 100px;max-height: 700px;color: white;box-sizing: border-box;border: solid #ffffff26 1px;}
.chatX_top { height: 20px; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 6px; user-select: none; }
.chatX_burger { position: absolute; left: 50%; transform: translateX(-50%); width: 20px; height: 20px;display: flex; flex-direction: column; justify-content: center; font-size: 16px; color: white; text-align: center; }
.chatX_close {position: absolute;right: 6px;width: 18px;height: 18px;line-height: 18px;text-align: center;color: white;font-size: 19px;cursor: pointer;}
.chatX_feed { flex: 1; overflow-y: auto; display: flex; flex-direction: column-reverse; gap: 8px; padding-right: 4px;}
.chatX_msg {position: relative;display: grid;grid-template-columns: 42px 1fr;background: #80808057;border-radius: 10px;padding: 8px 10px 8px 8px;box-sizing: border-box;column-gap: 15px;}
.chatX_avatar {width: 50px; height: 50px; border-radius: 100%; object-fit: cover;border: 2px solid;}
.avatarXcontainer{position: relative;grid-row: 1 / span 2;width: 50px;height: 50px;}
.avatarXcontainer::after {content: "verified_user";font-family: 'Material Icons';position: absolute;right: 1;bottom: 1;font-size: 19px;color: #08dd24;display: var(--after-display, none);text-shadow: #08dd24de 0 0 10px;}
.chatX_nick {font-size: 15px;max-width: 185px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;direction: ltr;font-weight: bold;height: 20px;}
.chatX_nick--accent { color: #ff4e3e; font-weight: 700; }
.chatX_text {min-height: 30px;font-size: 14px;color: white;}
.chatX_time { position: absolute; right: 8px; top: 6px; font-size: 11px; color: #dadada; }
.chatX_name_container{display: flex;gap: 3px;padding-bottom: 2px;align-items: baseline;}
#chat_textbox {padding: 10px 20px 10px 5px;box-sizing: border-box;margin-top: 8px;transition: all .5s ease-in-out;background: rgb(133 133 133 / 20%);border: solid 1px #ffffff3d;outline: none;color: #ffffff;text-indent: 12px;width: 100%;border-radius: 20px;}
#chat_textbox::placeholder { color: #606060; }
.chatX_alert { position: absolute; top: 30px; right: 10px; background: #ff4e3e; color: #fff; font-size: 13px; padding: 4px 8px; border-radius: 12px; display: none; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,.3); }
.nresize{cursor: n-resize !important;}
::-webkit-scrollbar {width: 3px;height: 0;}
::-webkit-scrollbar-thumb {background-color:#ffffff3b;border-radius: 10px; }
::-webkit-scrollbar-track {background: transparent;}
</style>

  <div class="chatX_window" id="chatX_window">
    <div class="chatX_top">
      <div class="chatX_burger" id="chatX_burger"><i class="fa-solid fa-bars nresize"></i></div>
      <div class="chatX_close" onclick="document.getElementById('chatX_window').style.display = 'none'; document.getElementById('onchat').style.display = 'flex';" id="chatX_close"><i class="fa-solid fa-xmark"></i></div>
    </div>

    <div class="chatX_feed" id="chatX_feed">
    </div>

    <div class="chatX_alert" id="chatX_alert"></div>

    <input class="noPress" id="chat_textbox" type="text" maxlength="120" autocomplete="off" placeholder="Напишите сообщение..." />
  </div>

<script>
const chatWindow = document.getElementById('chatX_window');
const feed = document.getElementById('chatX_feed');
const burger = document.getElementById('chatX_burger');

let startY = 0;
let startHeight = 0;
let startTop = 0;
let resizing = false;

// ===== drag & touch для burger =====
function startResize(e) {
    resizing = true;
    startY = e.touches ? e.touches[0].clientY : e.clientY;
    startHeight = chatWindow.offsetHeight;
    startTop = chatWindow.offsetTop;
    document.body.style.userSelect = 'none';
}

function doResize(e) {
    if (!resizing) return;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const dy = clientY - startY;
    let newHeight = startHeight - dy;
    let newTop = startTop + dy;

    if (newHeight < 100) { newTop -= (100-newHeight); newHeight = 100; }
    if (newHeight > 700) { newTop += (newHeight-700); newHeight = 700; }

    chatWindow.style.height = newHeight + 'px';
    chatWindow.style.top = newTop + 'px';
}

function stopResize() {
    resizing = false;
    document.body.style.userSelect = '';
}

burger.addEventListener('mousedown', startResize);
burger.addEventListener('touchstart', startResize, {passive: true});
document.addEventListener('mousemove', doResize);
document.addEventListener('touchmove', doResize, {passive: false});
document.addEventListener('mouseup', stopResize);
document.addEventListener('touchend', stopResize);
</script>
<div id="onchat" onclick="document.getElementById('chatX_window').style.display = 'flex'; document.getElementById('onchat').style.display = 'none';"><i class="fa fa-arrow-up"></i></div>


    <div class="homemenu" onclick="$('#overlays').show();"><i class="fas fa-home"></i></div>


    <div class="score-info" id="score-info">
        <div class="scorr" id="score-max">0</div>
        <div class="scorr" id="score-new">0</div>
        <div class="cell-length" id="cell-length">0</div>
    </div>
    <div id="leaderboard"></div>
    <div id="serverclose-overlay">
        <div id="serverclose">
            <i class="fas fa-spinner fa-spin"></i>
            <div>Соединение с сервером потеряно.</div>
            <div id="countdownclose">Перезагрузка через: 10</div>
        </div>
    </div>
<div id="map"class="map">
<div class="map-header">
  <div class="ping-container">ping: <span id="ping">0</span></div>
                <div class="mapclose" onclick="document.getElementById('map').style.display = 'none'; document.getElementById('onmap').style.display = 'flex';" ><i class="fa fa-close"></i></div>
            </div>
            
            <div class="map-container">
<span id="mapposition"></span>
                <div><span>A1</span></div>
                <div><span>A2</span></div>
                <div><span>A3</span></div>
                <div><span>A4</span></div>
                <div><span>A5</span></div>
                <div><span>B1</span></div>
                <div><span>B2</span></div>
                <div><span>B3</span></div>
                <div><span>B4</span></div>
                <div><span>B5</span></div>
                <div><span>C1</span></div>
                <div><span>C2</span></div>
                <div><span>C3</span></div>
                <div><span>C4</span></div>
                <div><span>C5</span></div>
                <div><span>D1</span></div>
                <div><span>D2</span></div>
                <div><span>D3</span></div>
                <div><span>D4</span></div>
                <div><span>D5</span></div>
                <div><span>E1</span></div>
                <div><span>E2</span></div>
                <div><span>E3</span></div>
                <div><span>E4</span></div>
                <div><span>E5</span></div>
            </div>
        </div>
<div id="onmap" onclick="document.getElementById('map').style.display = 'block'; document.getElementById('onmap').style.display = 'none';"><i class="fa fa-arrow-up"></i></div>
<div id="statics" class="overlays">

<div class="statsWrapper"><div class="headerstats"><h1 id="serverTitle">Статистика #ffa</h1></div>

<div style="width: 100%;height: 250px;display: flex;justify-content: center;align-items: center;">
  <a href="https://youtu.be/3Rbtwjb1Et0" target="_blank" style="position: relative;width: 100%;height: 100%;display: block;background: url(/assets/photo/bloger.jpg) center/cover no-repeat;text-decoration: none;">
    <!-- Логотип YouTube по центру -->
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png" alt="Play" style="position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 60px;height: 40px;">
  </a>
</div>
<h2 style="color: #fff200f0;text-shadow: #fff200f0 1px 0 10px;font-size: 20px;">Ждём твоё видео 🎥</h2>
<p style="font-size: 15px;line-height:1.6;font-weight:500;">
  <strong>1.</strong> Сними крутое видео по тематике <strong>agar.su</strong> и опубликуй его в социальных сетях: YouTube, TikTok, ВКонтакте.<br>
  <strong>2.</strong> Набери хотябы 10 просмотров.<br>
  <strong>3.</strong> Пришли нам ссылку в Telegram: <a href="https://t.me/agarsu" target="_blank" style="text-decoration: none;color: #016bef;">@agarsu</a> и мы добавим его сюда.</p>
</div>

<div id="statsWrapper" class="statsWrapper">
<div class="headerstats"><h1>Твоя Статистика</h1><div id="closeStats" onclick="document.getElementById('statics').style.display = 'none';$('#overlays').show();"><i class="fa-solid fa-xmark"></i></div></div>
        <canvas id="statsGraph" width="320" height="150"></canvas>
<div style="color: #01f103f0;text-shadow: #01f103f0 1px 0 10px;">поделиться:</div>
        <div id="buttons">
            <button class="social-btn fab fa-vk vk" title="ВКонтакте"></button>
            <button class="social-btn fab fa-telegram telegram" title="Telegram"></button>
            <button class="social-btn fab fa-whatsapp whatsapp" title="WhatsApp"></button>
            <button class="social-btn fab fa-facebook facebook" title="Facebook"></button>
            <button class="social-btn fab fa-twitter twitter" title="Twitter"></button>
        </div><div id="shareText"></div>
<div class="nav-buttons">
<div onclick="spectate();" class="nav-button serv-button"><i class="fas fa-eye"></i>Наблюдать</div>
<button id="button-text" onclick="startGame();return false;" class="nav-button play-button"><i class="fas fa-play"></i> ИГРАТЬ</button>
 </div>
</div>

<div class="statsWrapper">
<div class="headerstats"><h1>Статистика #ffa</h1></div>
 <div class="header-rowwraper">
                        <div>Позиция</div><div>Ник</div><div>Масса</div><div>Скин</div>
                    </div>
                    <div id="table-containerwraper"></div>
                    <script>
                        // Функция для получения данных статистики
                        async function fetchStats(stats) { // Изменяем здесь, чтобы принимать stats
                            try {
                                // Убедимся, что stats переданы и являются массивом
                                if (!Array.isArray(stats)) {
                                    throw new Error('Invalid stats data');
                                }

                                const skinsMap = await loadSkinsList(); // Загрузка skinsList

                                // Обновляем каждый player в stats
                                stats.forEach(player => {
                                    const skinId = skinsMap.get(player.nick.toLowerCase()) || 'PPFtwqH'; // Используем nick напрямую для skinId
                                    player.skin = skinId; // Установка skin для игрока
                                });

                                displayStats(stats);
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        // Функция для отображения статистики
                        function displayStats(stats) {
                            const container = document.getElementById('table-containerwraper');
                            container.innerHTML = ''; // Очищаем контейнер перед добавлением новых данных


stats.forEach((player, index) => {
    const playerDiv = document.createElement('div');
    playerDiv.classList.add('top-playerwraper');
    playerDiv.setAttribute('title', player.time); // добавляем атрибут title
    playerDiv.innerHTML = `
        <div>${index + 1}</div>
        <div>${player.nick}</div>
        <div>${player.score}</div>
        <div class="skinswraper"style="background-image: url('skins/${player.skin}.png');"></div>
    `;
    container.appendChild(playerDiv);
});
                        }

                    </script>
</div>

</div>
<style>

.headerstats {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center; /* по центру заголовок */
    margin-bottom: 10px;
    position: relative; /* контекст для крестика */
}

.headerstats h1 {
    margin: 0;
    text-align: center;
    flex: 1; /* занимает всю ширину, чтобы центр был точным */
}


#closeStats {
    position: absolute; 
    top: -10;
    right: 0;
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    cursor: pointer;
    transition: color 0.2s, transform 0.2s;
}

#closeStats:hover {
    color: #ff4d4d;
    transform: scale(1.2);
}

#closeStats {
    position: absolute;
    top: -10px;
    right: 0px;
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    cursor: pointer;
    transition: color 0.2s, transform 0.2s;
}
#closeStats:hover {
    color: #ff4d4d;
    transform: scale(1.2);
}
/* Полноэкранный темный фон */
#statics {
 gap:15px;
    display: none;
}
.statsWrapper {
    width: 380px;
    height: 500px;
    padding: 25px;
    background-color: #0e172c;
    border-radius: 25px;
    border: 1px solid #ffffff14;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

#table-containerwraper{
    width: 100%;
    overflow: scroll;
}
.header-rowwraper {
    display: grid;
    grid-template-columns: 1fr 2.5fr 1fr 1fr;
    justify-items: center;
}
.top-playerwraper{
    display: grid;
    grid-template-columns: 1fr 3fr 1fr 1fr;
    align-items: center;
    justify-items: center;
}
.skinswraper{
    background-size: cover;
    width: 30px;
    height: 30px;
    border: solid 2px;
    border-radius: 50%;
   margin-bottom: 2px;
}


#shareText {
    font-size: 18px;
    color: #c3c0c0;
    text-align: center;
    margin-bottom: 10px;
}
/* Кнопки */
#buttons {
    display: flex;
    gap: 10px;
}

.social-btn {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    background-size: 60% 60%;
    background-repeat: no-repeat;
    background-position: center;
    transition: transform 0.2s, background-color 0.2s; /* Добавляем transition для background-color */
    font-size: 30px; /* Этот стиль, вероятно, для Font Awesome, но может перекрываться. */
}

/* Общий :hover эффект */
.social-btn:hover {
    transform: scale(1.2);
}

/* Стили для конкретных соцсетей при наведении */

/* ВКонтакте */
.social-btn.vk:hover {
    background-color: #4a76a8; /* Фирменный цвет VK */
	    box-shadow: #4a76a8 1px 0 10px;
}

/* Telegram */
.social-btn.telegram:hover {
    background-color: #2ca5e2; /* Фирменный цвет Telegram */
	    box-shadow: #2ca5e2 1px 0 10px;
}

/* WhatsApp */
.social-btn.whatsapp:hover {
    background-color: #25d366; /* Фирменный цвет WhatsApp */
	    box-shadow: #25d366 1px 0 10px;
}

/* Facebook */
.social-btn.facebook:hover {
    background-color: #1877f2; /* Фирменный цвет Facebook */
	    box-shadow: #1877f2 1px 0 10px;
}

/* Twitter */
.social-btn.twitter:hover {
    background-color: #1da1f2; /* Фирменный цвет Twitter */
	    box-shadow: #1da1f2 1px 0 10px;
}

</style>
<div id="freeze" onclick="freeze = false;this.style.display = 'none';">Pause <i style="color:red;"class="fa fa-pause"></i></div>
<div id="notification-container">
  <div id="logout-notification" class="notification" style="display:none;">Login close</div>
</div>
<script>
function showLogoutNotification() {
    const notif = document.getElementById('logout-notification');
    if (!notif) return;

    notif.style.display = 'block';

    // Чтобы сработал transition, добавляем класс с задержкой
    setTimeout(() => {
      notif.classList.add('show');
    }, 10);

    // Через 3 секунды скрываем
    setTimeout(() => {
      notif.classList.remove('show');

      // После анимации прячем полностью
      notif.addEventListener('transitionend', () => {
          notif.style.display = 'none';
      }, { once: true });

    }, 3000);
}
</script>
<script>
const observer = new MutationObserver(() => {
  document.querySelectorAll('.star-container').forEach(container => {
    const levelElem = container.querySelector('.levelme');
    if (!levelElem) return;
    const level = parseInt(levelElem.textContent, 10);
    const star = container.querySelector('.fa-star');
    if (!star) return;
    if (level >= 50) {
      star.classList.add('high-level');
    } else {
      star.classList.remove('high-level');
    }
  });
});

// Запускаем наблюдатель за всей страницей (или более конкретным контейнером)
observer.observe(document.body, { childList: true, subtree: true });
</script>
</body>
</html>

















































