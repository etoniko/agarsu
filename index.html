<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description"content="agar.su - захватывающая онлайн-игра, где вам предстоит выживать, поглощая других игроков и избегая опасных врагов. Боритесь за лидерство и испытайте свои навыки!">
<meta name="keywords"content="игры, game, браузерная игра, агарио, agario, онлайн игра, клетка, выживание, agar.io">
<meta name="author" content="Agar.su Team">
<meta name="robots" content="index, follow">

<!-- Open Graph для социальных сетей -->
<meta property="og:title" content="Agar.su - захватывающая браузерная игра">
<meta property="og:description" content="Играйте в agar.su — мир клеток, где нужно выживать, поглощая других игроков и избегая опасностей.">
<meta property="og:image" content="https://i.imgur.com/aUnAuZ0.jpg">
<meta property="og:url" content="https://agar.su">
<meta property="og:type" content="website">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Agar.su - Браузерная онлайн-игра">
<meta name="twitter:description" content="Играйте в agar.su — поглотите других и боритесь за лидерство!">
<meta name="twitter:image" content="https://i.imgur.com/aUnAuZ0.jpg">

<!-- Подтверждение права на сайт -->
<meta name="yandex-verification" content="ae692c51c9b8486f">
<!-- Yandex Games SDK -->
<script src="https://sdk.games.s3.yandex.net/sdk.js"></script>

    <title>agar.su - Завоевание начинается!</title>

    <!-- Favicon и иконки для Apple устройств -->
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/etoniko/agarsu/icon.svg/icon.svg">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/etoniko/agarsu/icon.svg" type="image/svg+xml">
<!-- Canonical URL -->
<link rel="canonical" href="https://agar.su">

    <!-- Шрифты и стили -->
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=new_releases" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="./style.css?v=0.1.3" rel="stylesheet">

    <!-- Скрипты -->
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/log.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/etoniko/agarsu/vector.js"></script>
<script src="./main_out.js?v=0.3.8"></script>
    

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(98838177, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/98838177" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



<script type="text/javascript">
    (function(e, x, pe, r, i, me, nt){
    e[i]=e[i]||function(){(e[i].a=e[i].a||[]).push(arguments)},
    me=x.createElement(pe),me.async=1,me.src=r,nt=x.getElementsByTagName(pe)[0],me.addEventListener("error",function(){function cb(t){t=t[t.length-1],"function"==typeof t&&t({flags:{}})};Array.isArray(e[i].a)&&e[i].a.forEach(cb);e[i]=function(){cb(arguments)}}),nt.parentNode.insertBefore(me,nt)})
    (window, document, "script", "https://abt.s3.yandex.net/expjs/latest/exp.js", "ymab");

    ymab("metrika.98838177", "setConfig", {enableSetYmUid: true});
    ymab("metrika.98838177", "init"/*, {clientFeatures}, {callback}*/);
</script>

<!-- Yandex.RTB -->
<script>window.yaContextCb=window.yaContextCb||[]</script>
<script src="https://yandex.ru/ads/system/context.js" async></script>
</head>


<body>
<!-- Yandex.RTB R-A-15699059-6 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-15699059-6",
        "type": "fullscreen",
        "platform": "touch"
    })
})
</script>
    <div id="overlays" class="overlays">
      <!--<div class="social">
         <a href="https://t.me/agarsu" target="_blank" class="tg"><i
                 style="background: radial-gradient(white 9px, #1e90ff00 50%);border-radius: 50%;" class="fab fa-telegram"></i></a>
         <a href="#" class="soc"><i style="cursor: not-allowed;" class="fab fa-vk"></i></a>
         <a href="#" class="soc"><i style="cursor: not-allowed;" class="fab fa-discord"></i></a>
     </div>-->
<div class="add-left">
<!-- Yandex.RTB R-A-15699059-8 -->
<div id="yandex_rtb_R-A-15699059-8"></div>
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-15699059-8",
        "renderTo": "yandex_rtb_R-A-15699059-8"
    })
})
</script>
</div>
<div class="add-right">
</div>
<div class="add-top">
</div>
<div class="add-bottom">
</div>
        <div class="center">
            <div class="sidebar">
                <div class="menu-item" onclick="showContent('profile')">
                    <i class="fas fa-gear"></i>
                    <span class="label">Настройки</span>
                </div>
                <div class="menu-item" onclick="showContent('skinslist')">
                    <i class="fas fa-image"></i>
                    <span class="label">Скины</span>
                </div>
                <div class="menu-item active" onclick="showContent('home')">
                    <i class="fas fa-home"></i>
                    <span class="label">Главная</span>
                </div>
                <div class="menu-item" id="sst" onclick="showContent('rating')">
                    <i class="fas fa-star"></i>
                    <span class="label">Рейтинг</span>
                </div>
                <script>
                    document.getElementById('sst').addEventListener('click', function () {
                        chekstats();
                    });
                </script>
                <div class="menu-item" onclick="showContent('store')">
                    <i class="fas fa-user"></i>
                    <span class="label">Войти</span>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div id="profile" class="content">
                    <div class="top-info">
                        <div><span>Настройки</span></div>
                    </div>
<div class="checkbox-container">
     <label><input type="checkbox" class="save" data-box-id="2" onchange="setNames(!$(this).is(':checked'));">Оключить Имена</label>
     <label><input type="checkbox" class="save" data-box-id="4" onchange="setColors($(this).is(':checked'));">Без Цветов</label>
     <label><input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));" checked>Показать Массу</label>
     <label><input type="checkbox" class="save" data-box-id="6" onchange="setSmooth($(this).is(':checked'));">Простой Рендер</label>
     <label><input type="checkbox" class="save" data-box-id="7" onchange="setChatHide($(this).is(':checked'));">Отключить Чат</label>
     <label><div id="theme-selector"><label>Выберите тему:</label><select id="theme-select"><option value="gradient">Градиент</option><option value="white">Белая</option><option value="black">Черная</option></select></div></label>
 </div>
                </div>
                <div id="skinslist" class="content">
                    <div style="display: flex;flex-direction: column;justify-content: space-around;" class="top-info">
                        <div class="gall"><span>Скины</span></div>
                        <ul class="gallery">
                            <li style="background-image: url('https://i.imgur.com/tq33YWv.png');"
                                onclick="selectSkin('Муха');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/dzQIxk0.png');"
                                onclick="selectSkin('Паук');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/fpDpEl9.png');"
                                onclick="selectSkin('Кактус');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/69ChrNV.png');"
                                onclick="selectSkin('Зая');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/qRq5CIg.png');"
                                onclick="selectSkin('Оса');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/TPgKn6V.png');"
                                onclick="selectSkin('Ящерица');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/QPCVdvQ.png');"
                                onclick="selectSkin('Лиса');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/YbmC0tv.png');"
                                onclick="selectSkin('Волк');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/hmVJPmb.png');"
                                onclick="selectSkin('Мамонт');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/RKtDpin.png');"
                                onclick="selectSkin('Динозавр');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/3hxdGAq.png');"
                                onclick="selectSkin('Мороженое');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/zdcHEFS.png');"
                                onclick="selectSkin('Ракета');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/roUvNMV.png');"
                                onclick="selectSkin('Могучая');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/57BzylL.png');"
                                onclick="selectSkin('Фаун');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/rPlbHK7.png');"
                                onclick="selectSkin('Бабушка');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/ruAUEpb.png');"
                                onclick="selectSkin('Гора');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/ipqCMMf.png');"
                                onclick="selectSkin('Космонавт');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/wRiL4Jx.png');"
                                onclick="selectSkin('Первобытный');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/GTxoIhj.png');"
                                onclick="selectSkin('Влюблённый');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/EcW6zbE.png');"
                                onclick="selectSkin('Влюблённая');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/UINxrlJ.png');"
                                onclick="selectSkin('Самба');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/lxAXnAi.png');"
                                onclick="selectSkin('Снеговик');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/7GWqCnY.png');"
                                onclick="selectSkin('Панда');showContent('home')"></li>
                            <li style="background-image: url('https://i.imgur.com/4faALdC.png');"
                                onclick="selectSkin('Теннисистка');showContent('home')"></li>
                        </ul>

                    </div>
                </div>
                <!-- Home Content -->
                <div id="home" class="content active">
                    <div class="top-info">
                        <div><span>agar.su</span></div>
                    </div>
                    <div>
					<div class="line"></div>
                        <span id="process">Онлайн☹️: 0</span>
                        <span id="userXP"></span>
                        <span id="userLevel"></span>
                    </div>
<div class="progress-container">
  <div class="progress-bar">
    <div class="level-circle" id="levelCircle">0</div>
    <div class="progress-fill"></div>
    <div class="progress-text" id="progressText">0% (0/0)</div>
  </div>
</div>
<span id="accountID">ID: 0000</span>

                    <script>
                        async function updateOnlineCount() {
                            try {
                                const response = await fetch('https://itana.pw:6001/process'); // Запрос к серверу по /process
                                if (response.ok) {
                                    const data = await response.json(); // Преобразуем ответ в JSON
                                    document.getElementById('process').textContent = `Онлайн: ${data.online}`; // Обновляем текст в div
                                } else {
                                    console.error('Ошибка при получении данных:', response.status);
                                }
                            } catch (error) {
                                console.error('Произошла ошибка:', error);
                            }
                        }

                        updateOnlineCount();
                    </script>
                    <div class="avatar-containers">
                        <div class="avatar-container">
                            <div class="previous-skin" id="prevSkin" onclick="showPrevious()"></div>
                            <div class="arrow" id="previous" onclick="showPrevious()">&#10094;</div>
                            <div onclick="showContent('skinslist')" id="skinss" class="main-skin"></div>
                            <div class="arrow" id="next" onclick="showNext()">&#10095;</div>
                            <div class="next-skin" id="nextSkin" onclick="showNext()"></div>
                        </div>
                        <!-- Новый элемент сервера -->
                        <div id="server" class="server-containers" style="display: none;">
                            <div class="sgm">Выбери себе режим!</div>
                            <div class="gamemode">
                                <div class="thumbnail ffa actives" onclick="setserver('itana.pw:6001');">ФФА</div>
                                <div class="thumbnail crazy" onclick="setserver('itana.pw:6002');">КРЕЗИ</div>
                                <div style="cursor: not-allowed;opacity: 0.6;" class="thumbnails teams">ТИМА</div>
                                <div style="cursor: not-allowed;opacity: 0.6;" class="thumbnails exp">ЕКСП</div>
                                <script>
                                    function updateActiveThumbnail() {
                                        const hash = window.location.hash.substring(1);
                                        const thumbnails = document.querySelectorAll('.thumbnail');

                                        // Remove active from all
                                        thumbnails.forEach(el => el.classList.remove('actives'));

                                        // Add active based on hash, fallback to FFA
                                        const activeThumbnail = Array.from(thumbnails).find(el => el.classList.contains(hash)) || document.querySelector('.ffa');
                                        activeThumbnail.classList.add('actives');
                                    }

                                    // Initial check on page load
                                    updateActiveThumbnail();

                                    // Add event listener for hash changes
                                    window.addEventListener('hashchange', updateActiveThumbnail);


                                    // Add event listeners to thumbnails
                                    document.querySelectorAll('.thumbnail').forEach(item => {
                                        item.addEventListener('click', () => {
                                            //Remove active from all
                                            document.querySelectorAll('.thumbnail').forEach(el => el.classList.remove('actives'));

                                            //Add active to clicked
                                            item.classList.add('actives');

                                            //Update the URL hash
                                            window.location.hash = item.classList[1];
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="input-container">
                            <form>
                                <input type="text" placeholder="Ник" name="name" maxlength="15" id="nick" required
                                    autocomplete="username" />
                                <input type="password" placeholder="Пасс" name="pass" id="pass" required
                                    autocomplete="current-password" />
                            </form>
                        </div>
                    </div>

                    <script>
                        // Переменные для отслеживания действий
                        let lastActionTime = 0; // Время последнего действия
                        const actionInterval = 500; // Интервал между действиями (в мс)
                        let actionTimeout; // Таймер для обработки ввода
                        let currentIndex = 0; // Индекс текущего игрока

                        // Функция загрузки списка скинов
                        async function loadSkinsList() {
                            const response = await fetch('https://raw.githubusercontent.com/etoniko/agarsu/refs/heads/main/skinlist.txt');
                            const data = await response.text();
                            const skinsMap = new Map();

                            data.split('\n').forEach(line => {
                                const [nick, id] = line.split(':');
                                if (nick && id) skinsMap.set(nick.trim().toLowerCase(), id.trim());
                            });
                            return skinsMap;
                        }

                        // Функция нормализации ника для поиска
                        function normalizeNick(nick) {
                            return nick.trim().toLowerCase();
                        }

                        // Функция выбора скина и сохранения данных игрока в localStorage
                        async function selectSkin(nick) {
                            const skinsMap = await loadSkinsList();
                            const normalizedNick = normalizeNick(nick);

                            // Проверка, если скин найден
                            if (skinsMap.has(normalizedNick)) {
                                const id = skinsMap.get(normalizedNick);

                                // Сохранение данных игрока в localStorage
                                savePlayerData(nick, id);
                                currentIndex = getCurrentPlayerIndex(nick); // Обновление индекса
                                updateAvatarDisplay(); // Обновление аватара
                            } else {
                                document.querySelector("#skinss").style.backgroundImage = ""; // Очистка фона
                            }
                        }

                        // Функция получения текущего индекса игрока из localStorage
                        function getCurrentPlayerIndex(nick) {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            return players.findIndex(player => normalizeNick(player.nick) === normalizeNick(nick));
                        }

                        // Функция сохранения данных игрока в localStorage
                        function savePlayerData(nick, id) {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            const playerData = { nick, id }; // Сохраняем ник и скин

                            // Удаление дубликатов
                            const index = players.findIndex(player => normalizeNick(player.nick) === normalizeNick(nick));
                            if (index !== -1) players.splice(index, 1);

                            // Добавление нового игрока в начало
                            players.unshift(playerData);

                            // Ограничение хранения последних 3 игроков
                            if (players.length > 3) players.pop();

                            localStorage.setItem('players', JSON.stringify(players)); // Сохранение в localStorage
                        }

                        // Функция обновления отображения аватаров
                        function updateAvatarDisplay() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            const mainSkin = document.querySelector("#skinss");
                            const previousSkin = document.querySelector("#prevSkin");
                            const nextSkin = document.querySelector("#nextSkin");

                            // Очистка фонов
                            mainSkin.style.backgroundImage = "";
                            previousSkin.style.backgroundImage = "";
                            nextSkin.style.backgroundImage = "";

                            if (players.length > 0) {
                                const currentPlayer = players[currentIndex];
                                mainSkin.style.backgroundImage = `url(https://i.imgur.com/${currentPlayer.id}.png)`; // Выставляем скин
                                document.getElementById("nick").value = currentPlayer.nick;

                                // Установка предыдущего скина
                                const prevIndex = (currentIndex - 1 + players.length) % players.length;
                                if (players[prevIndex]) {
                                    previousSkin.style.backgroundImage = `url(https://i.imgur.com/${players[prevIndex].id}.png)`;
                                }

                                // Установка следующего скина
                                const nextIndex = (currentIndex + 1) % players.length;
                                if (players[nextIndex]) {
                                    nextSkin.style.backgroundImage = `url(https://i.imgur.com/${players[nextIndex].id}.png)`;
                                }
                            }
                        }

                        // Показ следующего игрока
                        function showNext() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            if (players.length > 0) {
                                currentIndex = (currentIndex + 1) % players.length;
                                changeSkin();
                            }
                        }

                        // Показ предыдущего игрока
                        function showPrevious() {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');
                            if (players.length > 0) {
                                currentIndex = (currentIndex - 1 + players.length) % players.length;
                                changeSkin();
                            }
                        }

                        // Анимация смены скина
                        function changeSkin() {
                            const mainSkin = document.querySelector("#skinss");
                            mainSkin.classList.add("scale-down");
                            setTimeout(() => {
                                updateAvatarDisplay();
                                mainSkin.classList.remove("scale-down");
                            }, 50);
                        }

                        // Обработчик ввода ника
                        document.getElementById('nick').addEventListener('input', function () {
                            const nickname = this.value;
                            clearTimeout(actionTimeout);
                            actionTimeout = setTimeout(async () => {
                                await selectSkin(nickname);
                            }, actionInterval);
                        });

                        // Загрузка сохранённых данных при загрузке страницы
                        window.addEventListener("load", function () {
                            const players = JSON.parse(localStorage.getItem('players') || '[]');

                            if (players.length > 0) {
                                currentIndex = 0;
                                updateAvatarDisplay();
                            }
                        });

                    </script>

                    <div class="nav-buttons">
                        <!--<span style="position: absolute;margin-right: 20px;color: #ffec0c;border-radius: 100%;background-image: linear-gradient(red, red);background-repeat:no-repeat;background-size: 14px 15px;background-position: center;" class="material-symbols-outlined">new_releases</span>-->
                        <div onclick="toggleServer();" class="nav-button serv-button"><i class="fas fa-server"></i>
                            СЕРВЕРА
                        </div>
                        <!-- change div -> button | Disabled button xxxevexxx -->
                        <button id="button-text" onclick="startGame(); return false;" class="nav-button play-button"><i
                                class="fas fa-play"></i> ИГРАТЬ</button>
<script>
                                                  let playButtonClickCount = 0; // Счётчик нажатий
                            let serverSet = false; // Флаг, чтобы вызвать setserver только один раз

                            async function startGame() {

                                setNick(document.getElementById('nick').value);

                                // Проверяем, инициализирован ли Yandex SDK, и запускаем геймплей
                                if (window.ysdk) {
                                    window.ysdk.features.GameplayAPI?.start();
                                    console.log("Геймплей начат");
                                } else {
                                    console.warn("SDK Яндекс Игр не инициализирован");
                                }

                                playButtonClickCount++; // Увеличиваем счётчик

                                const buttonText = document.getElementById("button-text");

                                if (playButtonClickCount === 2) {
                                }

                                if (playButtonClickCount === 3) {
                                    playButtonClickCount = 0; // Сбрасываем счётчик после третьего нажатия

                                    try {
                                        await window.ysdk.adv.showFullscreenAdv(); // Показ рекламы
                                        console.log("Реклама показана успешно");
                                    } catch (error) {
                                        console.error("Ошибка при показе рекламы:", error);
                                    } finally {
                                    }
                                }
                            }
                        </script>
                        <!-- change div -> button | Disabled button xxxevexxx -->
                        <button id="button-spec" class="spec" onclick="spectate();"><i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <script>
                        let isServerOpen = false; // Переменная для отслеживания состояния сервера

                        function toggleServer() {
                            if (isServerOpen) {
                                closeServer();
                            } else {
                                openServer();
                            }
                        }

                        function openServer() {
                            const server = document.getElementById('server');
                            const avatarContainer = document.querySelector('.avatar-container');
                            const inputContainer = document.querySelector('.input-container');
                            const sgm = document.querySelector('.sgm');
                            const photoGallery = document.querySelector('.gamemode');

                            server.style.display = 'flex'; // Показать элемент сервера
                            requestAnimationFrame(() => {
                                server.classList.add('visible'); // Анимация появления сервера
                                sgm.classList.add('visible'); // Анимация появления sgm
                                photoGallery.classList.add('visible'); // Анимация появления photo-gallery
                            });

                            // Скрываем аватар и input-container
                            avatarContainer.classList.add('hidden');
                            inputContainer.classList.add('hidden');

                            isServerOpen = true; // Устанавливаем состояние сервера в открытое
                        }

                        function closeServer() {
                            const server = document.getElementById('server');
                            const avatarContainer = document.querySelector('.avatar-container');
                            const inputContainer = document.querySelector('.input-container');
                            const sgm = document.querySelector('.sgm');
                            const photoGallery = document.querySelector('.gamemode');

                            server.classList.remove('visible'); // Анимация исчезновения сервера
                            sgm.classList.remove('visible'); // Анимация исчезновения sgm
                            photoGallery.classList.remove('visible'); // Анимация исчезновения photo-gallery

                            server.addEventListener('transitionend', () => {
                                server.style.display = 'none'; // Скрыть сервер после завершения анимации
                            }, { once: true });

                            // Показываем аватар и input-container
                            avatarContainer.classList.remove('hidden');
                            inputContainer.classList.remove('hidden');

                            isServerOpen = false; // Устанавливаем состояние сервера в закрытое
                        }

                    </script>
                </div>
                <div id="rating" class="content">
                    <div class="top-info">
                        <div><span>Лучшие Игроки</span></div>
                    </div>
                    <div class="header-row">
                        <div class="cell">Время</div>
                        <div class="cell">Позиция</div>
                        <div class="cell">Ник</div>
                        <div class="cell">Масса</div>
                        <div class="cell">Скин</div>
                    </div>
                    <div id="table-container"></div>
                    <script>
                        // Функция для получения данных статистики
                        async function fetchStats(stats) { // Изменяем здесь, чтобы принимать stats
                            try {
                                // Убедимся, что stats переданы и являются массивом
                                if (!Array.isArray(stats)) {
                                    throw new Error('Invalid stats data');
                                }

                                const skinsMap = await loadSkinsList(); // Загрузка skinsList

                                // Обновляем каждый player в stats
                                stats.forEach(player => {
                                    const skinId = skinsMap.get(player.nick.toLowerCase()) || 'PPFtwqH'; // Используем nick напрямую для skinId
                                    player.skin = skinId; // Установка skin для игрока
                                });

                                displayStats(stats);
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        // Функция для отображения статистики
                        function displayStats(stats) {
                            const container = document.getElementById('table-container');
                            container.innerHTML = ''; // Очищаем контейнер перед добавлением новых данных

                            stats.forEach((player, index) => {
                                const playerDiv = document.createElement('div');
                                playerDiv.classList.add('top-player');
                                playerDiv.innerHTML = `
            <div class="time">${player.time}</div> <!-- Добавлено время -->
            <div class="rank">${index + 1}</div>
            <div class="nick">${player.nick}</div>
            <div class="score">${player.score}</div>
            <div class="skkinn" style="background-image: url('https://i.imgur.com/${player.skin}.png');"></div>
        `;
                                container.appendChild(playerDiv);
                            });
                        }

                    </script>

                </div>
                <div id="store" class="content">
                    <div class="top-info">
                        <div><span>Кабинет</span></div>
                    </div>
                    <div class="header-row">
                        <button style="display:none" id="logoutButton" onclick="logoutAccount()">Выход</button>

                        <script src="//ulogin.ru/js/ulogin.js"></script>
                        <div id="loginButton" id="uLogin"
                            data-ulogin="callback=onUloginToken;display=panel;fields=photo,first_name,last_name;providers=vkontakte,odnoklassniki,mailru,facebook;hidden=other;redirect_uri=http%3A%2F%2Flocalhost%3A6969%2Fauth%2Fulogin">
                        </div>

                    </div>
                </div>
            </div>

            <script>
                function showContent(id) {
                    document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
                    document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));

                    document.querySelector(`.menu-item[onclick="showContent('${id}')"]`).classList.add('active');
                    document.getElementById(id).classList.add('active');
                }
            </script>
        </div>
    </div>

    <canvas id="canvas"></canvas>
    <script>
        // Получаем элементы канваса и div-элемента overlays
        var canvas = document.getElementById('canvas');
        var overlays = document.getElementById('overlays');

        // Добавляем слушатель события мыши на div-элемент overlays
        overlays.addEventListener('mousemove', function (event) {
            // Получаем позицию курсора относительно overlays
            var x = event.clientX - overlays.offsetLeft;
            var y = event.clientY - overlays.offsetTop;

            // Создаем событие мыши для канваса
            var canvasEvent = new MouseEvent('mousemove', {
                bubbles: true,
                cancelable: true,
                clientX: x,
                clientY: y
            });

            // Передаем событие канвасу
            canvas.dispatchEvent(canvasEvent);
        });

    </script>
<div class="overchat">
    <button id="toggleChatButton">
        <i class="fas fa-close"></i>
    </button>
    <div id="chat-container"></div>
    <input type="text" autocomplete="off" id="chat_textbox" maxlength="120" placeholder="Напишите сообщение...">
</div>
<script>
// Получаем элементы
const toggleChatButton = document.getElementById('toggleChatButton');
const chatContainer = document.getElementById('chat-container');
const chatTextBox = document.getElementById('chat_textbox');
const chatIcon = toggleChatButton.querySelector('i');
const overchatElement = document.querySelector("body > div.overchat"); // Получаем элемент overchat

// Начальное состояние чата (видимый)
let isChatVisible = true;

// Обработчик клика по кнопке
toggleChatButton.addEventListener('click', function() {
    if (isChatVisible) {
        // Если чат видимый, скрываем его с помощью высоты
        chatContainer.style.height = '0';
        chatTextBox.style.display = 'none'; // Скрываем текстовое поле
        chatIcon.classList.remove('fa-close');
        chatIcon.classList.add('fa-arrow-up');
        overchatElement.style.maxWidth = '43px'; // Устанавливаем max-width
    } else {
        // Если чат скрыт, показываем его
        chatContainer.style.height = 'auto';
        chatTextBox.style.display = 'block'; // Показываем текстовое поле
        chatIcon.classList.remove('fa-arrow-up');
        chatIcon.classList.add('fa-close');
        overchatElement.style.maxWidth = ''; // Сбрасываем max-width (применяется стиль по умолчанию)
    }

    // Переключаем состояние видимости чата
    isChatVisible = !isChatVisible;
});
</script>
    <div class="homemenu" onclick="$('#overlays').show();"><i class="fas fa-home"></i></div>


    <div class="score-info" id="score-info">
        <div class="scorr" id="score-max">0</div>
        <div class="scorr" id="score-new">0</div>
        <div class="cell-length" id="cell-length">0</div>
    </div>
    <div id="leaderboard"></div>
    <div id="serverclose-overlay">
    <div id="serverclose">
        <i class="fas fa-spinner fa-spin"></i> 
        <div>Соединение с сервером потеряно.</div>
        <div id="countdown">Перезагрузка через: 10</div>
    </div>
    </div>

<script>
(function() {
  function setCookie(name, value, days) {
    let expires = "";
    if (days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
  }

  function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  function closeMyCustomBanner() {
    const bannerContainer = document.querySelector('.my-custom-banner-container');
    if (bannerContainer) {
      bannerContainer.style.display = 'none';
      setCookie('myCustomBannerClosed', 'true', 7);
    }
  }

  function handleBannerClick() {
    setCookie('myCustomBannerClosed', 'true', 7); // Сохраняем переход в куки
  }

  function createBanner() {
    const bannerContainer = document.createElement('div');
    bannerContainer.className = 'my-custom-banner-container';

    const bannerLink = document.createElement('a');
    bannerLink.href = 'https://t.me/agarskins_bot';
    bannerLink.target = '_blank';
    bannerLink.className = 'my-custom-banner-link';
    bannerLink.addEventListener('click', handleBannerClick); // Важная строка

    const bannerImage = document.createElement('div');
    bannerImage.className = 'my-custom-banner-image';

    bannerLink.appendChild(bannerImage);
    bannerContainer.appendChild(bannerLink);

    const closeButton = document.createElement('button');
    closeButton.className = 'my-custom-close-button';
    closeButton.textContent = 'X';
    closeButton.onclick = closeMyCustomBanner;

    bannerContainer.appendChild(closeButton);

    document.body.prepend(bannerContainer);

    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText = `
      .my-custom-banner-container {
          position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  max-width: 95vw; /* Не выходит за границы экрана */
  width: auto;
  box-sizing: border-box;
        z-index: 100;
      }

      .my-custom-banner-image {
        width: 700px;
        height: 250px;
        background-image: url("./assets/photo/baner.png");
        background-size: cover;
        background-position: center;
        display: block;
        border: dashed red;
      }

      @media (max-width: 768px) {
        .my-custom-banner-image {
          width: 100%;
          height: auto;
          min-height: 150px;
        }
      }

      .my-custom-close-button {
        position: absolute;
        top: -10px;
        right: -10px;
        background-color: rgb(11, 20, 35);
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 25px;
        line-height: 1;
        z-index: 10;
        font-weight: bold;
      }

      .my-custom-close-button:hover {
        background-color: rgba(0, 0, 0, 0.8);
      }

      .my-custom-banner-link {
        display: block;
        width: 100%;
        height: 100%;
      }
    `;
    document.head.appendChild(styleSheet);
  }

  function checkMyCustomBannerVisibility() {
    const bannerClosed = getCookie('myCustomBannerClosed');
    if (bannerClosed === 'true') return;
    createBanner();
  }

  checkMyCustomBannerVisibility();
})();
</script>
</body>

</html>
