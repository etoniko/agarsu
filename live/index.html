<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Agar.su ‚Äî –ª—É—á—à–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ agar.io. –ò–≥—Ä–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å: –ø–æ–≥–ª–æ—â–∞–π—Ç–µ –∫–ª–µ—Ç–∫–∏, —Å–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏ —Å—Ç–∞–Ω—å—Ç–µ –ª–∏–¥–µ—Ä–æ–º —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –∫–ª–æ–Ω–æ–≤ agar –∏ agario.">
    <meta name="author" content="Agar.su Team">
    <meta name="robots" content="index">
    <!-- Open Graph –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π -->
    <meta property="og:title" content="Agar.su - –ó–∞–≤–æ–µ–≤–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!">
    <meta property="og:description" content="absorb cells, compete with other players, and become the leader among all agar and agario clones.">
    <meta property="og:image" content="assets/photo/ogimage.jpeg">
    <meta property="og:url" content="https://agar.su">
    <meta property="og:type" content="website">
    <title>Agar.su</title>
    <!-- Favicon –∏ –∏–∫–æ–Ω–∫–∏ –¥–ª—è Apple —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" href="/icon.svg" type="image/x-icon">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://agar.su">
    <!-- –®—Ä–∏—Ñ—Ç—ã –∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=new_releases" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://api.agar.su/assets/style.css" rel="stylesheet">
    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="/assets/scripts/jquery.js?0.0.2"></script>
    <script src="/assets/scripts/log.js?0.0.2"></script>
    <script src="/assets/scripts/vector.js?0.0.2"></script>
    <script src="https://api.agar.su/assets/scripts/main_out2.js"></script>
	<script src="https://api.agar.su/assets/scripts/shop.js" defer></script>
	<script src="/assets/scripts/all.js?0.0.35" defer></script>
	<script src="/assets/scripts/pass.js?0.0.2" defer></script>
	<script src="/assets/scripts/skins.js?0.0.2" defer></script>
	<script src="/assets/scripts/rating.js?0.0.4" defer></script>
</head>
<body>
  <div id="overlays" class="overlays">
    <div class="social"><a href="https://t.me/agarsu" target="_blank" class="tg"><i style="background: radial-gradient(white 9px, #1e90ff00 50%);border-radius: 50%;" class="fab fa-telegram"></i></a><a href="https://vk.com/club233723574" target="_blank" class="soc"><i class="fab fa-vk"></i></a><a href="#" class="soc"><i style="cursor: not-allowed;" class="fab fa-discord"></i></a></div>
    <div class="center">
      <div class="sidebar">
        <div class="menu-item" onclick="showContent('shop')"><i class="fas fa-shop"></i><span class="label">–ú–∞–≥–∞–∑–∏–Ω</span></div>
        <div class="menu-item" onclick="showContent('skinslist')"><i class="fas fa-image"></i><span class="label">–°–∫–∏–Ω—ã</span></div>
        <div class="menu-item active" onclick="showContent('home')"><i class="fas fa-home"></i><span class="label">–ì–ª–∞–≤–Ω–∞—è</span></div>
        <div class="menu-item" onclick="showContent('rating')"><i class="fas fa-star"></i><span class="label">–†–µ–π—Ç–∏–Ω–≥</span></div>
        <div class="menu-item" onclick="showContent('store')"><i class="fas fa-user"></i><span class="label">–í–æ–π—Ç–∏</span></div>
      </div>
      <div class="main-content">


<div id="shop" class="content">
	<div class="top-info"><div><span>–°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–∫–∏</span></div></div>
<div class="shop-container">
  <div class="avatar-section">
    <label id="previewContainer" for="fileInput">
      <canvas id="previewCanvas" width="512" height="512"></canvas>
      <img id="previewGif" alt="GIF preview">
    </label>
    <input type="file" id="fileInput" accept=".png,.jpg,.gif" autocomplete="off">
    <div id="fileError" class="error"></div>

    <form id="paymentForm" autocomplete="off">
      <div class="radio-group">
        <label><input type="radio" name="serviceType" value="personal" id="personal" checked autocomplete="off"><span>–î–ª—è —Å–µ–±—è</span></label>
        <label><input type="radio" name="serviceType" value="clan" id="clan" autocomplete="off"><span>–î–ª—è –∫–ª–∞–Ω–∞</span></label>
      </div>

      <div class="input-group">
        <div id="nicknameWrapper">
          <input type="text" id="nickname" placeholder="–ü—Ä–∏–¥—É–º–∞–π —Å–µ–±–µ –Ω–∏–∫" required maxlength="15" title="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫" autocomplete="off">
          <span id="charCount">0/15</span>
        </div>
        <div id="nicknameError" class="error"></div>
      </div>

      <div class="input-group">
        <div class="password-wrapper">
          <input type="password" id="password" placeholder="–ü—Ä–∏–¥—É–º–∞–π —Å–µ–±–µ –ø–∞—Ä–æ–ª—å" maxlength="5" autocomplete="off">
          <i id="togglePassword" class="fa-solid fa-eye eye"></i>
        </div>
        <div id="passwordError" class="error"></div>
      </div>

      <div id="formError" class="error"></div>
      <button type="submit" id="buyButton" disabled>–ö–£–ü–ò–¢–¨ –ó–ê 0 –†–£–ë–õ–ï–ô</button>
    </form>
  </div>

  <div class="oplata">
    <div id="calculator" style="display:none">
      <h3>–†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h3>
      <p id="clanMultiplier">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="multiplierText">1x (–¥–ª—è —Å–µ–±—è)</span></p>
      <p id="passwordCost">–ü–∞—Ä–æ–ª—å: 0 ‚ÇΩ</p>
      <p id="skinCost">–°–∫–∏–Ω: 0 ‚ÇΩ</p>
      <div id="totalAmount">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
    </div>
  </div>
</div>
        </div>

		  
        <div id="settings" class="content">
          <div class="top-info">
            <div><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></div>
          </div>
          <div class="checkbox-container">
<label>
  <input type="checkbox" class="save" data-box-id="1" onchange="setSkins($(this).is(':checked'));">–í–∏–¥–µ—Ç—å –°–∫–∏–Ω—ã
</label>
<label>
  <input type="checkbox" class="save" data-box-id="2" onchange="setNames($(this).is(':checked'));">–í–∏–¥–µ—Ç—å –ò–º–µ–Ω–∞
</label>
<label>
  <input type="checkbox" class="save" data-box-id="3" onchange="setColors($(this).is(':checked'));">–¶–≤–µ—Ç–∞
</label>
<label>
  <input type="checkbox" class="save" data-box-id="4" onchange="setMouseClicks($(this).is(':checked'));">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–∫–∞ –º—ã—à–∫–∏
</label>
<label>
  <input type="checkbox" class="save" data-box-id="5" onchange="setShowMass($(this).is(':checked'));" checked>–ü–æ–∫–∞–∑–∞—Ç—å –ú–∞—Å—Å—É
</label>
<label>
  <input type="checkbox" class="save" data-box-id="6" onchange="setSmooth($(this).is(':checked'));">–ü—Ä–æ—Å—Ç–æ–π –†–µ–Ω–¥–µ—Ä
</label>
<label>
  <input type="checkbox" class="save" data-box-id="7" onchange="setNoBorder($(this).is(':checked'));">–û—Ç–∫–ª—é—á–∏—Ç—å –æ–±–≤–æ–¥–∫—É
</label>
<label>
  <input type="checkbox" class="save" data-box-id="8" onchange="setChatHide($(this).is(':checked'));">–û—Ç–∫–ª—é—á–∏—Ç—å —á–∞—Ç
</label>
<label>
  <input type="checkbox" class="save" data-box-id="9" onchange="setGlow($(this).is(':checked'));" checked>–≠—Ñ—Ñ–µ–∫—Ç –õ–∏–º–∏—Ç–∞
</label>




			  
  <div id="theme-selector">
    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:</label>
    <select id="theme-select">
      <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
      <option value="white">–ë–µ–ª–∞—è</option>
      <option value="black">–ß–µ—Ä–Ω–∞—è</option>
    </select>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ -->
  <div id="gradient-settings">
  <div class="color-picker">
    <span>–¶–≤–µ—Ç —Ü–µ–Ω—Ç—Ä–∞:</span>
    <input type="color" id="gradient-center" value="#132745">
  </div>
  <div class="color-picker">
    <span>–¶–≤–µ—Ç –∫—Ä–∞—ë–≤:</span>
    <input type="color" id="gradient-edge" value="#000000">
  </div>
</div>
</div>
			  
          </div>
        <div id="skinslist" class="content">
          <div style="display: flex;flex-direction: column;justify-content: space-around;" class="top-info">
            <div class="gall"><span>–°–∫–∏–Ω—ã</span></div>
            <ul class="gallery">
              <li style="background-image: url('https://i.imgur.com/tq33YWv.png');" onclick="selectSkin('–ú—É—Ö–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/dzQIxk0.png');" onclick="selectSkin('–ü–∞—É–∫');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/fpDpEl9.png');" onclick="selectSkin('–ö–∞–∫—Ç—É—Å');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/69ChrNV.png');" onclick="selectSkin('–ó–∞—è');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/qRq5CIg.png');" onclick="selectSkin('–û—Å–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/TPgKn6V.png');" onclick="selectSkin('–Ø—â–µ—Ä–∏—Ü–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/QPCVdvQ.png');" onclick="selectSkin('–õ–∏—Å–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/YbmC0tv.png');" onclick="selectSkin('–í–æ–ª–∫');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/hmVJPmb.png');" onclick="selectSkin('–ú–∞–º–æ–Ω—Ç');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/RKtDpin.png');" onclick="selectSkin('–î–∏–Ω–æ–∑–∞–≤—Ä');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/3hxdGAq.png');" onclick="selectSkin('–ú–æ—Ä–æ–∂–µ–Ω–æ–µ');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/zdcHEFS.png');" onclick="selectSkin('–†–∞–∫–µ—Ç–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/roUvNMV.png');" onclick="selectSkin('–ú–æ–≥—É—á–∞—è');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/57BzylL.png');" onclick="selectSkin('–§–∞—É–Ω');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/rPlbHK7.png');" onclick="selectSkin('–ë–∞–±—É—à–∫–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/ruAUEpb.png');" onclick="selectSkin('–ì–æ—Ä–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/ipqCMMf.png');" onclick="selectSkin('–ö–æ—Å–º–æ–Ω–∞–≤—Ç');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/wRiL4Jx.png');" onclick="selectSkin('–ü–µ—Ä–≤–æ–±—ã—Ç–Ω—ã–π');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/GTxoIhj.png');" onclick="selectSkin('–í–ª—é–±–ª—ë–Ω–Ω—ã–π');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/EcW6zbE.png');" onclick="selectSkin('–í–ª—é–±–ª—ë–Ω–Ω–∞—è');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/UINxrlJ.png');" onclick="selectSkin('–°–∞–º–±–∞');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/lxAXnAi.png');" onclick="selectSkin('–°–Ω–µ–≥–æ–≤–∏–∫');showContent('home')"></li>
              <li style="background-image: url('https://i.imgur.com/7GWqCnY.png');" onclick="selectSkin('–ü–∞–Ω–¥–∞');showContent('home')"></li>
              <li>
                <a style="display: block;width: 100%;height: 100%;background-image: url('assets/photo/skinstg.png');background-size: cover;" onclick="showContent('shop');"></a>
              </li>
            </ul>
          </div>
        </div>
        <!-- Home Content -->
        <div id="home" class="content active">
          <div class="top-info">
            <div><span>agar.su</span>
              <div onclick="showContent('settings')" class="setting menu-item"><i class="fas fa-gear"></i></div>
            </div>
          </div>
          <div>
            <div class="line"></div></div>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="level-circle" id="levelCircle">0</div>
              <div class="progress-fill"></div>
              <div class="progress-text" id="progressText">0% (0/0)</div>
            </div>
          </div><span id="accountID">ID: 0000</span>
          <div class="avatar-containers">
            <div class="avatar-container">
              <div class="previous-skin" id="prevSkin" onclick="showPrevious()"></div>
              <div class="arrow" id="previous" onclick="showPrevious()">&#10094;</div>
              <div onclick="showContent('skinslist')" id="skinss" class="main-skin anims"></div>
              <div class="arrow" id="next" onclick="showNext()">&#10095;</div>
              <div class="next-skin" id="nextSkin" onclick="showNext()"></div>
            </div>
            <div class="input-container">
              <form>
                <input type="text" placeholder="–ù–∏–∫" name="name" maxlength="16" class="noPress" id="nick" required autocomplete="username" />
                <input type="password" placeholder="–ü–∞—Å—Å" name="pass" maxlength="6" class="noPress" id="pass" required autocomplete="current-password" />
              </form>
            </div>
          </div>
		  <div class="servers">
		  <ul class="gamemode">
<ul class="gamemode">
  <li data-ip="ffa.agar.su:6001" id="ffa"><span class="fi fi-ru"></span>FFA - ùôàùô§ùô®ùôòùô§ùô¨<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/120</span></li>
  <li data-ip="ffa.agar.su:6002" id="ms"><span class="fi fi-ru"></span>MegaSplit<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/120</span></li>
  <li data-ip="ffa.agar.su:6003" id="exp"><span class="fi fi-ru"></span>Experemental<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/50</span></li>
	<li data-ip="ffa.agar.su:6004" id="pvp1"><span class="fi fi-ru"></span>pvp1: 1x1 ffa 1k<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/50</span></li>
	<li data-ip="ffa.agar.su:6005" id="pvp2"><span class="fi fi-ru"></span>pvp2: 2x2 ms 1k<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/50</span></li>
	<li data-ip="ffa.agar.su:6006" id="tournament"><span class="fi fi-ru"></span>Tournament<i class="fas fa-eye"></i><span class="online-count">0</span><i class="fas fa-user"></i><span class="online-count">0/120</span></li>
</ul> 
</div>
          <div class="nav-buttons">
            <button onclick="spectate();" class="nav-button serv-button"><i class="fas fa-eye"></i> –ù–ê–ë–õ–Æ–î–ê–¢–¨ </button>
            <button onclick="startGame();return false;" class="nav-button play-button"><i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨ </button>
          </div>
        </div>
        <div id="rating" class="content">
          <div class="top-info">
            <div><span>–õ—É—á—à–∏–µ –ò–≥—Ä–æ–∫–∏</span></div>
          </div>
          <div class="header-row">
            <div class="cell">–ü–æ–∑–∏—Ü–∏—è</div>
            <div class="cell nr">–ù–∏–∫</div>
            <div class="cell">–£—Ä–æ–≤–µ–Ω—å</div>
            <div class="cell">–ê–≤–∞—Ç–∞—Ä</div>
          </div>
          <div id="table-container"></div>
        </div>
        <div id="store" class="content">
          <div class="top-info">
            <div><span>–ö–∞–±–∏–Ω–µ—Ç</span></div>
          </div>
          <div>
<div id="myNicknamesBlock" style="display:none;">
  <div class="tabs" id="myNickClanTabs" data-ready="1">
    <button id="tabNicknames" type="button" class="tab active">–í–∞—à–∏ –Ω–∏–∫–∏ <span class="badge" id="badgeNick">0</span></button>
    <button id="tabClans" type="button" class="tab">–í–∞—à–∏ –∫–ª–∞–Ω—ã <span class="badge" id="badgeClan">0</span></button>
	<button id="logoutButton" class="tab" onclick="logoutAccount()">–í—ã—Ö–æ–¥</button>
  </div>
  <div class="list-wrap" id="nickWrap" style=""><ul id="myNickList" class="list"></ul></div>
  <div class="list-wrap" id="clanWrap" style="display:none;"><ul id="myClanList" class="list"></ul></div>
</div>
<div id="authlog">
  <!-- Google -->
  <div id="g_id_onload"
       data-client_id="157257230972-jhlcisbgal67sn75gib37fb1m1de5jiu.apps.googleusercontent.com"
       data-auto_prompt="false"
       data-callback="onGoogleAuth"></div>
  <div class="g_id_signin"></div>

  <!-- Telegram -->
  <script async src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="agarsu_auth_bot"
          data-size="large"
          data-onauth="onTelegramAuth(user)"
          data-request-access="write"></script>
</div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <canvas id="canvas"></canvas>
  <script>
(() => {
  const TAG = "__CANVAS_REC_ONLY__";
  if (window[TAG]) { console.warn("Recorder already running"); return; }
  window[TAG] = true;

  // ====== helpers ======
  const pickMime = () => {
    const prefs = [
      'video/webm;codecs=vp9',
      'video/webm;codecs=vp8',
      'video/webm'
    ];
    for (const t of prefs) { if (MediaRecorder.isTypeSupported(t)) return t; }
    return ''; // let browser choose
  };

  const formatTime = (ms) => {
    const s = Math.floor(ms/1000)%60;
    const m = Math.floor(ms/60000)%60;
    const h = Math.floor(ms/3600000);
    const pad = n => String(n).padStart(2,'0');
    return (h? `${h}:`:'') + `${pad(m)}:${pad(s)}`;
  };

  const downloadBlob = (blob, name) => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = name;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 0);
  };

  // ====== find canvas ======
  const canvas = document.getElementById('canvas');
  if (!canvas || !(canvas instanceof HTMLCanvasElement)) {
    alert('–ù–µ –Ω–∞–π–¥–µ–Ω <canvas id="canvas">');
    window[TAG] = false;
    return;
  }

  // ====== UI (shadow DOM) ======
  const host = document.createElement('div');
  Object.assign(host.style, {
    position: 'fixed', inset: '16px auto auto 16px', zIndex: 2147483647
  });
  document.documentElement.appendChild(host);
  const root = host.attachShadow({ mode: 'open' });
  root.innerHTML = `
    <style>
      :host{ all:initial; }
      .p{ font: 13px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
          color:#e9e9ee;background:#17171a;border:1px solid #333;border-radius:12px;
          box-shadow:0 8px 24px rgba(0,0,0,.35); min-width: 280px; }
      .h{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid #2b2b30; cursor:move; user-select:none;}
      .dot{ width:10px; height:10px; border-radius:50%; background:#666; box-shadow:0 0 0 0 rgba(255,64,64,.6); }
      .ttl{ font-weight:600; letter-spacing:.2px; }
      .b{ padding:10px 12px; display:grid; gap:10px;}
      .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
      .btn{ appearance:none; border:1px solid #3a3a40; background:#222227; color:#eee; padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;}
      .btn[disabled]{ opacity:.4; cursor:not-allowed;}
      .sel,.num,.chk{ background:#1d1d22; border:1px solid #2e2e35; color:#e9e9ee; border-radius:10px; padding:6px 10px; }
      .num{ width:90px; }
      .stat{ font-variant-numeric: tabular-nums; color:#9aa0a6; }
      .hint{ color:#9aa0a6; font-size:12px;}
      .pill{ padding:4px 8px; background:#101014; border:1px solid #2b2b30; border-radius:999px; }
    </style>
    <div class="p">
      <div class="h" id="drag">
        <div class="dot" id="dot"></div>
        <div class="ttl">Canvas Recorder</div>
        <div style="margin-left:auto" class="pill" id="dim"></div>
      </div>
      <div class="b">
        <div class="row">
          <button class="btn" id="start">‚óè Start</button>
          <button class="btn" id="pause" disabled>Pause</button>
          <button class="btn" id="stop" disabled>Stop & Save</button>
          <span class="stat" id="timer">00:00</span>
        </div>
        <div class="row">
          <label>FPS:
            <select class="sel" id="fps">
              <option value="60"selected>60</option>
              <option value="50">50</option>
              <option value="30">30</option>
              <option value="24">24</option>
            </select>
          </label>
          <label>–ë–∏—Ç—Ä–µ–π—Ç (–≤–∏–¥–µ–æ kbps):
            <input class="num" id="vbr" type="number" min="100" max="50000" step="100" value="8000">
          </label>
          <label class="row">
            <input class="chk" id="mic" type="checkbox">
            <span>–ú–∏–∫—Ä–æ—Ñ–æ–Ω</span>
          </label>
        </div>
        <div class="hint">–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ #canvas. –§–∞–π–ª: WebM.</div>
      </div>
    </div>
  `;

  // draggable
  (() => {
    const drag = root.getElementById('drag');
    let sx=0, sy=0, ox=host.offsetLeft, oy=host.offsetTop, d=false;
    drag.addEventListener('pointerdown', e => { d=true; sx=e.clientX; sy=e.clientY; ox=host.offsetLeft; oy=host.offsetTop; drag.setPointerCapture(e.pointerId); });
    drag.addEventListener('pointermove', e => { if(!d) return; host.style.left = (ox + e.clientX - sx)+'px'; host.style.top = (oy + e.clientY - sy)+'px'; });
    drag.addEventListener('pointerup', () => d=false);
  })();

  const $ = id => root.getElementById(id);
  const dot   = $('dot');
  const dim   = $('dim');
  const btnS  = $('start');
  const btnP  = $('pause');
  const btnT  = $('stop');
  const timer = $('timer');
  const fpsEl = $('fps');
  const vbrEl = $('vbr');
  const micEl = $('mic');

  const updateDim = () => dim.textContent = `${canvas.width}√ó${canvas.height}`;
  setTimeout(updateDim, 1000);

  let chunks = [];
  let rec = null;
  let startedAt = 0;
  let tInt = null;
  let stream = null;
  let micStream = null;

  const setState = (state) => {
    // idle | recording | paused
    if (state === 'idle') {
      btnS.disabled = false;
      btnP.disabled = true;
      btnT.disabled = true;
      dot.style.background = '#666';
      dot.style.boxShadow = 'none';
    } else if (state === 'recording') {
      btnS.disabled = true;
      btnP.disabled = false;
      btnT.disabled = false;
      dot.style.background = '#e53935';
      dot.style.boxShadow = '0 0 0 9px rgba(229,57,53,.15)';
    } else if (state === 'paused') {
      btnS.disabled = true;
      btnP.disabled = false;
      btnT.disabled = false;
      dot.style.background = '#f6c945';
      dot.style.boxShadow = '0 0 0 9px rgba(246,201,69,.15)';
    }
  };
  setState('idle');

  const tick = () => {
    const now = Date.now();
    timer.textContent = formatTime(now - startedAt);
  };

  const buildFileName = () => {
    const d = new Date();
    const iso = d.toISOString().replace(/[:.]/g,'-');
    return `canvas-record-${canvas.width}x${canvas.height}-${iso}.webm`;
  };

  async function startRec() {
    try {
      // fresh buffers
      chunks = [];

      const fps = parseInt(fpsEl.value, 10) || 30;
      const vbr = Math.max(100, Math.min(50000, parseInt(vbrEl.value,10) || 8000)) * 1000;

      // capture only the canvas video
      const cvsStream = canvas.captureStream(fps);

      // optional mic track
      if (micEl.checked) {
        micStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
        const audioTrack = micStream.getAudioTracks()[0];
        if (audioTrack) cvsStream.addTrack(audioTrack);
      }

      // prefer chosen mime
      const mimeType = pickMime();
      const options = { mimeType, videoBitsPerSecond: vbr };
      rec = new MediaRecorder(cvsStream, options);

      stream = cvsStream;

      rec.ondataavailable = e => { if (e.data && e.data.size) chunks.push(e.data); };
      rec.onstop = () => {
        clearInterval(tInt); tInt = null;
        setState('idle');
        try {
          const blob = new Blob(chunks, { type: rec.mimeType || 'video/webm' });
          downloadBlob(blob, buildFileName());
        } catch (err) {
          console.error(err);
          alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏');
        } finally {
          chunks = [];
          // cleanup streams
          stream?.getTracks().forEach(t=>t.stop());
          micStream?.getTracks().forEach(t=>t.stop());
          stream = null; micStream = null; rec = null;
          dot.style.boxShadow = 'none';
        }
      };

      rec.start(250); // gather chunks every 250ms
      startedAt = Date.now();
      timer.textContent = '00:00';
      if (!tInt) tInt = setInterval(tick, 250);
      setState('recording');

    } catch (e) {
      console.error(e);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å. –í–æ–∑–º–æ–∂–Ω–æ, –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç MediaRecorder/WebM.');
      setState('idle');
    }
  }

  function stopRec() {
    try { rec?.stop(); } catch(e){ console.warn(e); }
  }

  function togglePause() {
    if (!rec) return;
    if (rec.state === 'recording') {
      rec.pause();
      setState('paused');
    } else if (rec.state === 'paused') {
      rec.resume();
      setState('recording');
    }
  }

  btnS.addEventListener('click', startRec);
  btnT.addEventListener('click', stopRec);
  btnP.addEventListener('click', togglePause);

  // clean up if page unloads
  window.addEventListener('beforeunload', () => {
    try { if(rec && rec.state!=='inactive') rec.stop(); } catch {}
    try { stream?.getTracks().forEach(t=>t.stop()); } catch {}
    try { micStream?.getTracks().forEach(t=>t.stop()); } catch {}
    window[TAG]=false;
  });

})();
</script>




	
  
  <div class="chatX_window" id="chatX_window">
    <div class="chatX_top" id="chatX_top">
	<div onclick="switchToDialog(null);" class="chatX_top_avatar"><i class="fa fa-globe"></i></div>
      <div class="chatX_burger" id="chatX_burger"><i class="fa-solid fa-bars nresize"></i></div>
      <div class="chatX_close" onclick="document.getElementById('chatX_window').style.display = 'none'; document.getElementById('onchat').style.display = 'flex';" id="chatX_close"><i class="fa-solid fa-xmark"></i></div>
    </div>
    <div class="chatX_container" id="chatX_container">
      <div class="chatX_feed" id="chatX_feed">	  </div>
    </div>
	  		  	  	  <div class="emoji-list">
  <div class="emoji-item" data-code=":50:"><img src="/emoji/50.gif"></div>
  <div class="emoji-item" data-code=":253:"><img src="/emoji/253.gif"></div>
  <div class="emoji-item" data-code=":26:"><img src="/emoji/26.gif"></div>
  <div class="emoji-item" data-code=":104:"><img src="/emoji/104.png"></div>
  <div class="emoji-item" data-code=":105:"><img src="/emoji/105.png"></div>
  <div class="emoji-item" data-code=":92:"><img src="/emoji/92.png"></div>
  <div class="emoji-item" data-code=":5:"><img src="/emoji/5.png"></div>
</div>
    <div class="chatX_emch">
      <div class="coord" id="emoji_toggle"><i class="fa-solid fa-face-grin-squint"></i></div>
	 <input style="display:none;" id="ls"></input>
      <input class="noPress" id="chat_textbox" maxlength="120" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off"></input>
    </div>
  </div>
  <div id="onchat"><i class="fa fa-message"></i></div>
  <div class="homemenu"><i class="fas fa-home"></i></div>
  <div class="score-info" id="score-info">
    <div class="scorr" id="score-max">0</div>
    <div class="scorr" id="score-new">0</div>
    <div class="cell-length" id="cell-length">0</div>
  </div>
  <div id="leaderboard"><div class="topclose" onclick="document.getElementById('leaderboard').style.display = 'none'; document.getElementById('onleaderboard').style.display = 'flex';"><i class="fa fa-close"></i></div><h4>–¢–æ–ø –°–µ–π—á–∞—Å</h4><div id="toplistnow"></div></div>
<div id="onleaderboard"><i class="fa fa-bar-chart"></i></div>
  <div id="serverclose-overlay">
    <div id="serverclose"><i class="clozs fas fa-spinner fa-spin"></i>
      <div>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ—Ç–µ—Ä—è–Ω–æ.</div>
		<div class="closereset" onclick="location.reload()" >reset</div>
    </div>
  </div>
  <div id="map" class="map">
    <div class="map-header">
      <div class="ping-container">
    ping: <span id="ping">0</span> | fps: <span id="fps">0</span>
</div>

      <div class="mapclose" onclick="document.getElementById('map').style.display = 'none'; document.getElementById('onmap').style.display = 'flex';"><i class="fa fa-close"></i></div>
    </div>
    <div class="map-container"><span id="mapposition"></span>
      <div><span>A1</span></div>
      <div><span>A2</span></div>
      <div><span>A3</span></div>
      <div><span>A4</span></div>
      <div><span>A5</span></div>
      <div><span>B1</span></div>
      <div><span>B2</span></div>
      <div><span>B3</span></div>
      <div><span>B4</span></div>
      <div><span>B5</span></div>
      <div><span>C1</span></div>
      <div><span>C2</span></div>
      <div><span>C3</span></div>
      <div><span>C4</span></div>
      <div><span>C5</span></div>
      <div><span>D1</span></div>
      <div><span>D2</span></div>
      <div><span>D3</span></div>
      <div><span>D4</span></div>
      <div><span>D5</span></div>
      <div><span>E1</span></div>
      <div><span>E2</span></div>
      <div><span>E3</span></div>
      <div><span>E4</span></div>
      <div><span>E5</span></div>
    </div>
  </div>
  <div id="onmap"><i class="fa fa-compass"></i></div>
  <div id="statics" class="overlays">
    <div class="statsWrapper">
      <div class="headerstats">
        <h1>–ë–ª–æ–≥–µ—Ä—Å–∫–∞—è –¢–µ–º–∞</h1></div>
      <div class="statYout">
        <a href="https://youtu.be/RvGQwzrDFtE" target="_blank" class="statYoutt"><img src="https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png" alt="Play" class="statYoutImg"></a>
      </div>
      <h2 class="statTitle">–ñ–¥—ë–º —Ç–≤–æ—ë –≤–∏–¥–µ–æ üé•</h2>
      <p class="statDesc"><strong>1.</strong> –°–Ω–∏–º–∏ –∫—Ä—É—Ç–æ–µ –≤–∏–¥–µ–æ –ø–æ —Ç–µ–º–∞—Ç–∏–∫–µ <strong>agar.su</strong> –∏ –æ–ø—É–±–ª–∏–∫—É–π –µ–≥–æ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö: YouTube, TikTok, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ.
        <br><strong>2.</strong> –ù–∞–±–µ—Ä–∏ —Ö–æ—Ç—è–±—ã 10 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤.
        <br><strong>3.</strong> –ü—Ä–∏—à–ª–∏ –Ω–∞–º —Å—Å—ã–ª–∫—É –≤ Telegram: <a href="https://t.me/agarsu" target="_blank" class="statLink">@agarsu</a> –∏ –º—ã –¥–æ–±–∞–≤–∏–º –µ–≥–æ —Å—é–¥–∞.</p>
    </div>
    <div id="statsWrapper" class="statsWrapper">
      <div class="headerstats">
        <h1>–¢–≤–æ—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
        <div id="closeStats" class="closeStats"><i class="fa-solid fa-xmark"></i></div>
      </div>
      <canvas id="statsGraph" width="320" height="150"></canvas>
      <div class="share-label">–ø–æ–¥–µ–ª–∏—Ç—å—Å—è:</div>
      <div id="buttons">
        <button class="social-btn fab fa-vk vk" title="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ"></button>
        <button class="social-btn fab fa-telegram telegram" title="Telegram"></button>
        <button class="social-btn fab fa-whatsapp whatsapp" title="WhatsApp"></button>
        <button class="social-btn fab fa-facebook facebook" title="Facebook"></button>
        <button class="social-btn fab fa-twitter twitter" title="Twitter"></button>
      </div>
      <div id="shareText"></div>
      <div class="nav-buttons">
        <div onclick="spectate();" class="nav-button serv-button"><i class="fas fa-eye"></i>–ù–∞–±–ª—é–¥–∞—Ç—å</div>
        <button id="button-text" onclick="startGame();return false;" class="nav-button play-button"><i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨</button>
      </div>
    </div>
    <div class="statsWrapper">
      <div class="headerstats">
        <h1 id="serverTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ffa</h1></div>
      <div class="header-rowwraper">
        <div>–ü–æ–∑–∏—Ü–∏—è</div>
        <div>–ù–∏–∫</div>
        <div>–°—á–µ—Ç</div>
        <div>–°–∫–∏–Ω</div>
      </div>
      <div id="table-containerwraper"></div>
    </div>
  </div>
  <div id="freeze">Pause <i style="color:red;" class="fa fa-pause"></i></div>
  <div id="notification-container">
    <div id="logout-notification" class="notification">Login close</div>
  </div>
</body>

</html>
